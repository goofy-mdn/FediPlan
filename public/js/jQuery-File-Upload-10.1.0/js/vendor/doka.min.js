/* eslint-disable */

/*!
 * Doka 4.7.2
 * Copyright 2019 PQINA Inc - All Rights Reserved
 * Please visit https://pqina.nl/doka/ for further information
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Doka=e():t.Doka=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e){return e.parentNode.insertBefore(t,e)},i=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)};function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=function(t){return"object"===o(t)&&null!==t};function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){u(t,e,n[e])})}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},s=function(t){var e={};return l(t,function(n){!function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,n):t[e]=n}(e,n,t[n])}),e},f=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)};function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d=["svg","path"],p=function(t){return d.includes(t)},m=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===h(e)&&(n=e,e=null);var r=p(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return e&&(p(t)?f(r,"class",e):r.className=e),l(n,function(t,e){f(r,t,e)}),r},g=function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}},y=function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}};function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){E(t,e,n[e])})}return t}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w=function(t,e,n,r){var i=n[0]||t.left,o=n[1]||t.top,a=i+t.width,c=o+t.height*(r[1]||1),u={element:v({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:i,top:o,right:a,bottom:c}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){_(u.inner,v({},t.inner)),_(u.outer,v({},t.outer))}),b(u.inner),u.outer.bottom+=u.element.marginBottom,u.outer.right+=u.element.marginRight,b(u.outer),u},_=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},b=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},O=function(t){return"number"==typeof t},T=function(t){return t<.5?2*t*t:(4-2*t)*t-1};function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var I={spring:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,r=t.damping,i=void 0===r?.75:r,o=t.mass,a=void 0===o?10:o,c=t.delay,u=void 0===c?0:c,l=null,f=null,h=0,d=!1,p=null,m=s({interpolate:function(t){if(null===p&&(p=t),!(t-u<p||d)){if(!O(l)||!O(f))return d=!0,void(h=0);!function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<r&&Math.abs(n)<r}(f+=h+=-(f-l)*n/a,l,h*=i)?m.onupdate(f):(f=l,h=0,d=!0,m.onupdate(f),m.oncomplete(f))}},target:{set:function(t){if(O(t)&&!O(f)&&(f=t,p=null),null===l&&(l=t,f=t,p=null),d&&(p=null),f===(l=t)||void 0===l)return d=!0,h=0,p=null,m.onupdate(f),void m.oncomplete(f);d=!1},get:function(){return l}},resting:{get:function(){return d}},onupdate:function(t){},oncomplete:function(t){}});return m},tween:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,i=void 0===r?500:r,o=n.easing,a=void 0===o?T:o,c=n.delay,u=void 0===c?0:c,l=null,f=!0,h=!1,d=null,p=s({interpolate:function(n){f||null===d||(null===l&&(l=n),n-l<u||((t=n-l-u)<i?(e=t/i,p.onupdate((t>=0?a(h?1-e:e):0)*d)):(t=1,e=h?0:1,p.onupdate(e*d),p.oncomplete(e*d),f=!0)))},target:{get:function(){return h?0:d},set:function(t){if(null===d)return d=t,p.onupdate(t),void p.oncomplete(t);t<d?(d=1,h=!0):(h=!1,d=t),f=!1,l=null}},resting:{get:function(){return f}},onupdate:function(t){},oncomplete:function(t){}});return p}},A=function(t,e,n){var r=t[e]&&"object"===x(t[e][n])?t[e][n]:t[e]||t,i="string"==typeof r?r:r.type,o="object"===x(r)?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){R(t,e,n[e])})}return t}({},r):{};return I[i]?I[i](o):null};function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var M=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var i=t,o=function(){return n[t]},a=function(e){return n[t]=e};"object"===C(t)&&(i=t.key,o=t.getter||o,a=t.setter||a),e[i]&&!r||(e[i]={get:o,set:a})})})};function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(t){return null!=t};function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){G(t,e,n[e])})}return t}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var D={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},V=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},U=function(t,e){var n=e.opacity,r=e.perspective,i=e.translateX,o=e.translateY,a=e.scaleX,c=e.scaleY,u=e.rotateX,l=e.rotateY,s=e.rotateZ,f=e.originX,h=e.originY,d=e.width,p=e.height,m="",g="";(P(f)||P(h))&&(g+="transform-origin: ".concat(f||0,"px ").concat(h||0,"px;")),P(r)&&(m+="perspective(".concat(r,"px) ")),(P(i)||P(o))&&(m+="translate3d(".concat(i||0,"px, ").concat(o||0,"px, 0) ")),(P(a)||P(c))&&(m+="scale3d(".concat(P(a)?a:1,", ").concat(P(c)?c:1,", 1) ")),P(s)&&(m+="rotateZ(".concat(s,"rad) ")),P(u)&&(m+="rotateX(".concat(u,"rad) ")),P(l)&&(m+="rotateY(".concat(l,"rad) ")),m.length&&(g+="transform:".concat(m,";")),P(n)&&(g+="opacity:".concat(n,";"),0===n&&"BUTTON"===t.nodeName&&(g+="visibility:hidden;"),n<1&&(g+="pointer-events:none;")),P(p)&&(g+="height:".concat(p,"px;")),P(d)&&(g+="width:".concat(d,"px;"));var y=t.elementCurrentStyle||"";g.length===y.length&&g===y||(t.setAttribute("style",g),t.elementCurrentStyle=g)},N={styles:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,i=t.viewExternalAPI,o=t.view,a=L({},n),c={};M(e,[r,i],n);var u=function(){return o.rect?w(o.rect,o.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:u},i.rect={get:u},e.forEach(function(t){n[t]=void 0===a[t]?D[t]:a[t]}),{write:function(){if(V(c,n))return U(o.element,n),Object.assign(c,L({},n)),!0},destroy:function(){}}},listeners:function(t){var e,n=t.viewExternalAPI,r=t.view,i=[],o=(e=r.element,function(t,n){e.addEventListener(t,n)}),a=function(t){return function(e,n){t.removeEventListener(e,n)}}(r.element);return n.on=function(t,e){i.push({type:t,fn:e}),o(t,e)},n.off=function(t,e){i.splice(i.findIndex(function(n){return n.type===t&&n.fn===e}),1),a(t,e)},{write:function(){return!0},destroy:function(){i.forEach(function(t){a(t.type,t.fn)})}}},animations:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,i=t.viewExternalAPI,o=(t.viewState,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){S(t,e,n[e])})}return t}({},n)),a=[];return l(e,function(t,e){var c=A(e);c&&(c.onupdate=function(e){n[t]=e},c.target=o[t],M([{key:t,setter:function(t){c.target!==t&&(c.target=t)},getter:function(){return n[t]}}],[r,i],n,!0),a.push(c))}),{write:function(t){var e=!0;return a.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},apis:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewExternalAPI;M(e,r,n)}},k=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t};function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){z(t,e,n[e])})}return t}function z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var B=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,r=t.name,i=void 0===r?null:r,o=t.attributes,a=void 0===o?{}:o,c=t.read,u=void 0===c?function(){}:c,l=t.write,f=void 0===l?function(){}:l,h=t.create,d=void 0===h?function(){}:h,p=t.destroy,v=void 0===p?function(){}:p,E=t.filterFrameActionsForChild,_=void 0===E?function(t,e){return e}:E,b=t.didCreateView,O=void 0===b?function(){}:b,T=t.didWriteView,R=void 0===T?function(){}:T,x=t.ignoreRect,I=void 0!==x&&x,A=t.ignoreRectUpdate,C=void 0!==A&&A,M=t.mixins,S=void 0===M?[]:M;return function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=m(n,i?"doka--".concat(i):null,a),c=window.getComputedStyle(o,null),l=k(),h=null,p=!1,E=[],b=[],T={},x={},A=[f],M=[u],P=[v],L=function(){return o},G=function(){return[].concat(E)},D=function(){return h||(h=w(l,E,[0,0],[1,1]))},V=function(){return o.layoutCalculated=!1},U={element:{get:L},style:{get:function(){return c}},childViews:{get:G}},z=j({},U,{rect:{get:D},ref:{get:function(){return T}},is:function(t){return i===t},appendChild:(e=o,function(t,n){void 0!==n&&e.children[n]?e.insertBefore(t,e.children[n]):e.appendChild(t)}),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return E.push(t),t},unlinkView:function(t){E.splice(E.indexOf(t),1)},appendChildView:g(0,E),removeChildView:y(o,E),registerWriter:function(t){return A.push(t)},registerReader:function(t){return M.push(t)},registerDestroyer:function(t){return P.push(t)},invalidateLayout:V,dispatch:t.dispatch,query:t.query}),B={element:{get:L},childViews:{get:G},rect:{get:D},resting:{get:function(){return p}},isRectIgnored:function(){return I},invalidateLayout:V,_read:function(){h=null,E.forEach(function(t){return t._read()}),!(C&&l.width&&l.height)&&k(l,o,c);var t={root:F,props:r,rect:l};M.forEach(function(e){return e(t)})},_write:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0===e.length;return A.forEach(function(i){!1===i({props:r,root:F,actions:e,timestamp:t})&&(n=!1)}),b.forEach(function(e){!1===e.write(t)&&(n=!1)}),E.filter(function(t){return!!t.element.parentNode}).forEach(function(r){r._write(t,_(r,e))||(n=!1)}),E.forEach(function(r,i){r.element.parentNode||(F.appendChild(r.element,i),r._read(),r._write(t,_(r,e)),n=!1)}),p=n,R({props:r,root:F,actions:e,timestamp:t}),n},_destroy:function(){b.forEach(function(t){return t.destroy()}),P.forEach(function(t){t({root:F})}),E.forEach(function(t){return t._destroy()})}},Y=j({},U,{rect:{get:function(){return l}}});Object.keys(S).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var e=N[t]({mixinConfig:S[t],viewProps:r,viewState:x,viewInternalAPI:z,viewExternalAPI:B,view:s(Y)});e&&b.push(e)});var F=s(z);d({root:F,props:r});var q=(o.children||[]).length;return E.forEach(function(t,e){F.appendChild(t.element,q+e)}),O(F),s(B)}},Y=function(t,e){return function(n){var r=n.root,i=n.props,o=n.actions,a=void 0===o?[]:o,c=n.timestamp;a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:r,props:i,action:e.data,timestamp:c})}),e&&e({root:r,props:i,actions:a,timestamp:c})}},F=function(t){return Array.isArray(t)},q=function(t){return null==t},W=function(t){return t.trim()},X=function(t){return""+t},Z=function(t){return"boolean"==typeof t},H=function(t){return"string"==typeof t},K=function(t){return O(t)?t:H(t)?X(t).replace(/[a-z]+/gi,""):0},Q=function(t){return parseInt(K(t),10)},J=function(t){return O(t)&&isFinite(t)&&Math.floor(t)===t},$=function(t){if(J(t))return t;var e=X(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*Q(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*Q(e)):Q(e)};function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var et=function(t){return F(t)?"array":function(t){return null===t}(t)?"null":J(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":tt(t)},nt={array:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return q(t)?[]:F(t)?t:X(t).split(e).map(W).filter(function(t){return t.length})},boolean:function(t){return Z(t)?t:"true"===t},int:function(t){return"bytes"===et(t)?$(t):Q(t)},float:function(t){return parseFloat(K(t))},bytes:$,string:function(t){return function(t){return"function"==typeof t}(t)?t:X(t)},object:function(t){try{return JSON.parse(t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",'))}catch(e){return t}},file:function(t){return t},function:function(t){return function(t){for(var e=self,n=t.split("."),r=null;r=n.shift();)if(!(e=e[r]))return null;return e}(t)}},rt=function(t,e,n){if(t===e)return t;var r,i=et(t);if(i!==n){var o=(r=t,nt[n](r));if(i=et(o),null===o)throw'Trying to assign value with incorrect type to "'.concat(option,'", allowed type: "').concat(n,'"');t=o}return t},it=function(t){var e={};return l(t,function(n){var r,i,o,a=H(t[n])?t[n]:n,c=t[a];a===n?e[n]=(r=c[0],i=c[1],o=r,{enumerable:!0,get:function(){return o},set:function(t){o=rt(t,r,i)}}):e[n]=e[a]}),s(e)},ot=function(t){t.file=null,t.activeView=null,t.rootRect={x:0,y:0,left:0,top:0,width:0,height:0},t.stage=null,t.stageOffset=null,t.image=null,t.zoomTimeoutId=null,t.instantUpdate=!1,t.filePromise=null,t.fileLoader=null,t.instructions={size:null,crop:null,filter:null,color:null},t.filter=null,t.filterName=null,t.filterValue=null,t.colorValues={},t.colorMatrices={},t.size={width:!1,height:!1,aspectRatioLocked:!0,aspectRatioPrevious:!1},t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,draft:{rectangle:null,transforms:null}}},at=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},ct=function(t,e){t!==e&&console.warn("'".concat(t,"' is deprecated, please use '").concat(e,"' instead."))},ut=function(t){return function(e,n,r){var i={};return l(t,function(t){var n=at(t,"_").toUpperCase();i["SET_".concat(n)]=function(i){var o;try{o=r.options[t],r.options[t]=i.value}catch(t){}e("DID_SET_".concat(n),{value:r.options[t],prevValue:o})}}),i}},lt=function(t){return function(e){var n={};return l(t,function(t){n["GET_".concat(at(t,"_").toUpperCase())]=function(n){return e.options[t]}}),n}},st=function(){return Math.random().toString(36).substr(2,9)},ft=function(){var t=[],e=function(e,n){var r,i;r=t,i=t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}),r.splice(i,1)};return{fire:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,r)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,r){t.push({event:n,cb:function(){e(n,r),r.apply(void 0,arguments)}})},off:e}},ht={BOOLEAN:"boolean",INT:"int",NUMBER:"number",STRING:"string",ARRAY:"array",OBJECT:"object",FUNCTION:"function",ACTION:"action",SERVER_API:"serverapi",REGEX:"regex",FILE:"file"},dt="undefined"!=typeof window&&void 0!==window.document,pt=function(){return dt},mt=null,gt=function(){return null===mt&&(mt=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),mt};function yt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt=function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){yt(t,e,n[e])})}return t}({},wt)},Et=function(t,e){t=function(t){return H(wt[t])?wt[t]:t}(t),wt[t][0]=rt(e,wt[t][0],wt[t][1])},wt={id:[null,ht.STRING],className:[null,ht.STRING],src:[null,ht.FILE],maxImagePreviewWidth:[1500,ht.INT],maxImagePreviewHeight:[1500,ht.INT],allowPreviewFitToView:[!0,ht.BOOLEAN],allowButtonCancel:[!0,ht.BOOLEAN],allowButtonConfirm:[!0,ht.BOOLEAN],allowDropFiles:[!1,ht.BOOLEAN],allowAutoClose:[!0,ht.BOOLEAN],allowAutoDestroy:[!1,ht.BOOLEAN],utils:[["crop"],ht.ARRAY],initialState:[null,ht.OBJECT],outputData:[!1,ht.BOOLEAN],outputFile:[!0,ht.BOOLEAN],outputStripImageHead:[!0,ht.BOOLEAN],outputType:[null,ht.STRING],outputQuality:[null,ht.INT],outputFit:["cover",ht.STRING],outputUpscale:[!0,ht.BOOLEAN],outputWidth:[null,ht.INT],outputHeight:[null,ht.INT],outputCanvasMemoryLimit:[pt()&&gt()?16777216:null,ht.INIT],size:[null,ht.OBJECT],sizeMin:[{width:1,height:1},ht.OBJECT],sizeMax:[{width:9999,height:9999},ht.OBJECT],filter:[null,ht.OBJECT],filters:[{original:{label:"Original",matrix:function(){return null}},chrome:{label:"Chrome",matrix:function(){return[1.398,-.316,.065,-.273,.201,-.051,1.278,-.08,-.273,.201,-.051,.119,1.151,-.29,.215,0,0,0,1,0]}},fade:{label:"Fade",matrix:function(){return[1.073,-.015,.092,-.115,-.017,.107,.859,.184,-.115,-.017,.015,.077,1.104,-.115,-.017,0,0,0,1,0]}},mono:{label:"Mono",matrix:function(){return[.212,.715,.114,0,0,.212,.715,.114,0,0,.212,.715,.114,0,0,0,0,0,1,0]}},noir:{label:"Noir",matrix:function(){return[.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,0,0,0,1,0]}}},ht.OBJECT],crop:[null,ht.OBJECT],cropShowSize:[!1,ht.BOOLEAN],cropZoomTimeout:[null,ht.INT],cropMask:[null,ht.FUNCTION],cropMaskInset:[0,ht.INT],cropAllowImageTurnRight:[!1,ht.BOOLEAN],cropResizeKeyCodes:[[18,91,92,93],ht.ARRAY],cropAspectRatio:[null,ht.STRING],cropAspectRatioOptions:[null,ht.ARRAY],cropMinImageWidth:[1,ht.INT],cropMinImageHeight:[1,ht.INT],colorBrightness:[0,ht.NUMBER],colorBrightnessRange:[[-.25,.25],ht.ARRAY],colorContrast:[1,ht.NUMBER],colorContrastRange:[[.5,1.5],ht.ARRAY],colorExposure:[1,ht.NUMBER],colorExposureRange:[[.5,1.5],ht.ARRAY],colorSaturation:[1,ht.NUMBER],colorSaturationRange:[[0,2],ht.ARRAY],beforeCreateBlob:[null,ht.FUNCTION],afterCreateBlob:[null,ht.FUNCTION],onconfirm:[null,ht.FUNCTION],oncancel:[null,ht.FUNCTION],onclose:[null,ht.FUNCTION],onload:[null,ht.FUNCTION],onloaderror:[null,ht.FUNCTION],onupdate:[null,ht.FUNCTION],oninit:[null,ht.FUNCTION],ondestroy:[null,ht.FUNCTION],labelButtonReset:["Reset",ht.STRING],labelButtonCancel:["Cancel",ht.STRING],labelButtonConfirm:["Done",ht.STRING],labelButtonUtilCrop:["Crop",ht.STRING],labelButtonUtilResize:["Resize",ht.STRING],labelButtonUtilFilter:["Filter",ht.STRING],labelButtonUtilColor:["Colors",ht.STRING],labelStatusAwaitingImage:["Waiting for image…",ht.STRING],labelStatusLoadImageError:["Error loading image…",ht.STRING],labelStatusLoadingImage:["Loading image…",ht.STRING],labelStatusProcessingImage:["Processing image…",ht.STRING],labelColorBrightness:["Brightness",ht.STRING],labelColorContrast:["Contrast",ht.STRING],labelColorExposure:["Exposure",ht.STRING],labelColorSaturation:["Saturation",ht.STRING],labelButtonCropZoom:["Zoom",ht.STRING],labelButtonCropRotateLeft:["Rotate left",ht.STRING],labelButtonCropRotateRight:["Rotate right",ht.STRING],labelButtonCropRotateCenter:["Center rotation",ht.STRING],labelButtonCropFlipHorizontal:["Flip horizontal",ht.STRING],labelButtonCropFlipVertical:["Flip vertical",ht.STRING],labelButtonCropAspectRatio:["Aspect ratio",ht.STRING],styleCropCorner:["circle",ht.STRING],styleFullscreenSafeArea:[pt()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",ht.STRING],styleLayoutMode:[null,ht.STRING]},_t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},bt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return parseFloat(t.toFixed(e))},Ot=function(t,e){return{x:bt(t.x,e),y:bt(t.y,e)}},Tt=function(t,e){return At(t.x-e.x,t.y-e.y)},Rt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(Tt(t,e),Tt(t,e))}(t,e))},xt=function(t,e){return At(_t(t.x,e.x,e.x+e.width),_t(t.y,e.y,e.y+e.height))},It=function(t,e,n){var r=Math.cos(e),i=Math.sin(e),o=At(t.x-n.x,t.y-n.y);return At(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},At=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Ct=function(t,e,n){return Ut(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)},Mt=function(t,e){return Ut(t.x+e.x,t.y+e.y,t.width,t.height)},St={translate:Mt,rotate:function(t,e,n){var r=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:It(t.tl,e,n),tr:It(t.tr,e,n),br:It(t.br,e,n),bl:It(t.bl,e,n)}}(Vt(t),e,n),i=r.tl,o=r.tr,a=r.br,c=r.bl,u=Math.min(i.x,o.x,a.x,c.x),l=Math.min(i.y,o.y,a.y,c.y),s=Math.max(i.x,o.x,a.x,c.x),f=Math.max(i.y,o.y,a.y,c.y);return Ut(u,l,s-u,f-l)},scale:Ct},Pt=function(t){return Ut(t.x,t.y,t.width,t.height)},Lt=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},Gt=function(t){var e=t.top,n=t.right,r=t.bottom,i=t.left;return{x:i,y:e,width:n-i,height:r-e}},Dt=function(t){return At(t.x+.5*t.width,t.y+.5*t.height)},Vt=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},Ut=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},Nt=function(t){if(q(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)},kt=function(t,e){var n=t.width,r=n*e;return r>t.height&&(n=(r=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-r),width:n,height:r}},jt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.height/t.width,i=e,o=1,a=r;a>i&&(o=(a=i)/r);var c=Math.max(1/o,i/a),u=t.width/(n*c*o);return{width:u,height:u*e}},zt=function(t,e){return{x:t,y:e}},Bt=function(t,e){return zt(t.x-e.x,t.y-e.y)},Yt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(Bt(t,e),Bt(t,e))}(t,e))},Ft=function(t,e){var n=t,r=e,i=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(i),u=Math.cos(i),l=n/o;return zt(u*(l*a),u*(l*c))},qt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,a=2*i*t.width,c=2*o*t.height,u=function(t,e){var n=t.width,r=t.height,i=Ft(n,e),o=Ft(r,e),a=zt(t.x+Math.abs(i.x),t.y-Math.abs(i.y)),c=zt(t.x+t.width+Math.abs(o.y),t.y+Math.abs(o.x)),u=zt(t.x-Math.abs(o.y),t.y+t.height-Math.abs(o.x));return{width:Yt(a,c),height:Yt(a,u)}}(e,n);return Math.max(u.width/a,u.height/c)},Wt=function(t,e){var n=e.origin,r=e.translation;return function(t,e,n){return e.reduce(function(t,e){return(0,St[e[0]])(t,e[1],n)},t)}(t,[["scale",e.scale],["translate",r]],n)},Xt=function(t,e){var n=t,r=e,i=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(i),u=Math.cos(i),l=n/o;return At(u*(l*a),u*(l*c))},Zt=function(t,e){var n=t.width,r=t.height,i=e%(Math.PI/2),o=Xt(n,i),a=Xt(r,i),c=Vt(t);return{tl:At(c.tl.x+Math.abs(o.x),c.tl.y-Math.abs(o.y)),tr:At(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:At(c.br.x-Math.abs(o.x),c.br.y+Math.abs(o.y)),bl:At(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}},Ht=function(t,e,n){var r=n.origin,i=n.translation,o=Wt(t,n),a={x:r.x+i.x,y:r.y+i.y},c=2*Math.PI+n.rotation%(2*Math.PI),u=Zt(e,c),l=It(u.tl,-c,a),s=It(u.tr,-c,a),f=It(u.br,-c,a),h={x:Math.min(l.x,s.x,f.x),y:Math.min(l.y,s.y,f.y),width:Math.max(l.x,s.x,f.x)-Math.min(l.x,s.x,f.x),height:Math.max(l.y,s.y,f.y)-Math.min(l.y,s.y,f.y)},d=Ut(h.x,h.y,h.width,h.height),p=Dt(d),m=e.height/e.width,g={x:(p.x-o.x)/o.width,y:(p.y-o.y)/o.height},y=g.y>.5?1-g.y:g.y,v=2*(g.x>.5?1-g.x:g.x)*o.width,E=2*y*o.height;return{center:g,zoom:Math.min(v/d.width,E/d.height),rotation:n.rotation,aspectRatio:m}};function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Qt(t,e,n[e])})}return t}function Qt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Jt=function(t,e){var n=$t(t,e);return{center:{x:bt(n.center.x),y:bt(n.center.y)},rotation:bt(n.rotation),zoom:bt(n.zoom),aspectRatio:bt(n.aspectRatio),flip:Kt({},e.flip)}},$t=function(t,e){var n=Ht(t,e.rectangle,e.transforms);return{center:{x:n.center.x,y:n.center.y},rotation:n.rotation,zoom:n.zoom,aspectRatio:n.aspectRatio,flip:Kt({},e.flip)}},te=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"width",o=t.width,a=t.height;if(!o&&!a)return{width:o,height:a};if(o=o&&_t(o,e.width,n.width),a=a&&_t(a,e.height,n.height),!r)return{width:o,height:a};if(a)if(o)"width"===i?a=o/r:"height"===i?o=a*r:(a*r<e.width?a=(o=e.width)/r:o/r<e.height&&(o=(a=e.height)*r),a*r>n.width?a=(o=n.width)/r:o/r>n.height&&(o=(a=n.height)*r));else{a=_t(a*r,e.width,n.width)/r}else o=_t(o/r,e.height,n.height)*r;return{width:o,height:a}};function ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ne(t,e,n[e])})}return t}function ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function re(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var ie=[],oe=function(t){var e=[];return l(t,function(t,n){return e.push(n)}),e.length?e.reduce(function(t,e){return n=re(t),r=e,(i=new Array(20))[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],i[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],i[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],i[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],i[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],i[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],i[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],i[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],i[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],i[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],i[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],i[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],i[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],i[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],i[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],i[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],i[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],i[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],i[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],i[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],i;var n,r,i},e.shift()):[]},ae=function(t){return t.crop.draft.transforms?t.crop.draft.transforms.scale:t.crop.transforms.scale},ce=function(t){var e=t.image.width/t.image.naturalWidth,n=ae(t);return{width:t.options.cropMinImageWidth*n*e,height:t.options.cropMinImageHeight*n*e}},ue=function(t){var e=ae(t);return{width:t.image.width*e,height:t.image.height*e}},le=function(t){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){return{label:t.label,value:t.value?Nt(t.value):null}}):null},se=function(t){return{ALLOW_MANUAL_RESIZE:function(){return t.options.utils.includes("resize")},GET_SIZE:function(){return!1!==t.size.width&&!1!==t.size.height?{width:t.size.width,height:t.size.height}:{width:null,height:null}},GET_SIZE_INPUT:function(){return{width:t.size.width,height:t.size.height}},GET_SIZE_ASPECT_RATIO_LOCK:function(){return t.size.aspectRatioLocked},IS_ACTIVE_VIEW:function(e){return t.activeView===e},GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return ee({},t.stage,t.stageOffset)},GET_ROOT:function(){return t.rootRect},GET_MIN_IMAGE_SIZE:function(){return{width:t.options.cropMinImageWidth,height:t.options.cropMinImageHeight}},GET_IMAGE_PREVIEW_SCALE_FACTOR:function(){return t.image.width/t.image.naturalWidth},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var e=t.image.width/t.image.naturalWidth;return{width:t.options.cropMinImageWidth*e,height:t.options.cropMinImageHeight*e}},GET_MIN_CROP_SIZE:function(){return ce(t)},GET_MAX_CROP_SIZE:function(){return ue(t)},GET_MIN_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=ce(t);return{width:n.width/e,height:n.height/e}},GET_MAX_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=ue(t);return{width:n.width/e,height:n.height/e}},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return le(t)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){var e=t.crop.aspectRatio;return H(e)?Nt(e):e},GET_CROP_ASPECT_RATIO:function(){var e=H(t.options.cropAspectRatio)?Nt(t.options.cropAspectRatio):t.options.cropAspectRatio,n=le(t);return n?n.find(function(t){return t.value===e})?e:n[0].value:e},GET_CROP_RECTANGLE_ASPECT_RATIO:function(){var e=t.crop,n=e.rectangle,r=e.aspectRatio;return n?n.width/n.height:r},GET_CROP_FLIP:function(){return t.crop.flip?ee({},t.crop.flip):ee({},t.instructions.crop.flip)},GET_CROP_ROTATION:function(){return ee({},t.crop.rotation)},GET_CROP:function(e,n){var r=ie[e];if(r&&r.ts===n)return r;var i=pe(t);return i&&(i.ts=n,ie[e]=i),i},GET_COLOR_MATRIX:function(){return oe(t.colorMatrices)},GET_COLOR_VALUES:function(){return ee({exposure:t.options.colorExposure,brightness:t.options.colorBrightness,contrast:t.options.colorContrast,saturation:t.options.colorSaturation},t.colorValues)},GET_PREVIEW_IMAGE_DATA:function(){return t.file.preview},GET_THUMB_IMAGE_DATA:function(){return t.file.thumb},GET_FILTER:function(){return t.filter}}},fe=function(t,e){var n=function(t){return!1===t.size.width?function(t){return t.options.size?t.options.size.width:null}(t):t.size.width}(t),r=function(t){return!1===t.size.height?function(t){return t.options.size?t.options.size.height:null}(t):t.size.height}(t),i=e.width/e.height;return te({width:n,height:r},t.options.sizeMin,t.options.sizeMax,i)},he=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.zoom,r=e.rotation,i=e.center,o=e.aspectRatio,a=jt(t,o,n),c={x:.5*a.width,y:.5*a.height},u={x:0,y:0,width:a.width,height:a.height,center:c},l=n*qt(t,kt(u,o),r,i);return{widthFloat:a.width/l,heightFloat:a.height/l,width:Math.round(a.width/l),height:Math.round(a.height/l)}},de=function(t,e){var n,r,i=Dt(e),o=Dt(t);return r=i,!(bt((n=o).x)===bt(r.x)&&bt(n.y)===bt(r.y))},pe=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||{free:t.crop.rectangle,limited:t.crop.rectangle},n=t.crop.draft.transforms||t.crop.transforms,r=n.origin,i=n.translation,o=n.scale,a=n.interaction,c=t.crop.rotation,u=t.crop.flip,s=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),f=s||t.instantUpdate,h=de(e.limited,t.stage),d=t.crop.isDirty||s,p=t.crop.isRotating,m={width:t.image.naturalWidth,height:t.image.naturalHeight},g=oe(t.colorMatrices),y={crop:he(m,$t(t.image,{rectangle:e.limited,transforms:{origin:r,translation:i,scale:o,rotation:c.main+c.sub},flip:u})),image:fe(t,e.limited)},v={x:0,y:0},E=0,w=0;if(f&&a){if(a.translation){var _=a.translation.x-i.x,b=a.translation.y-i.y;v.x=100*Math.sign(_)*Math.log10(1+Math.abs(_)/100),v.y=100*Math.sign(b)*Math.log10(1+Math.abs(b)/100)}if(a.scale){var O=a.scale-o;E=.25*Math.sign(O)*Math.log10(1+Math.abs(O)/.25)}if(a.rotation){var T=a.rotation-(c.main+c.sub);w=.05*Math.sign(T)*Math.log10(1+Math.abs(T)/.05)}}var R={},x=e.free,I=Lt(x),A=Lt(e.limited);return l(I,function(t){var e=I[t]-A[t];R[t]=A[t]+5*Math.sign(e)*Math.log10(1+Math.abs(e)/5)}),{canRecenter:h,canReset:d,isDraft:f,isRotating:p,cropRect:{x:R.left,y:R.top,width:R.right-R.left,height:R.bottom-R.top},origin:r,translation:i,translationBand:v,scale:o,scaleBand:E,rotation:c,rotationBand:w,flip:u,interaction:a,cropStatus:y,colorMatrix:g}},me=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var i=0;i<r;i++)if(274===t.getUint16(e+12*i,n))return t.getUint16(e+12*i+8,n)},ge=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,r=e.byteLength,i=2;i<r;){if(e.getUint16(i+2,!1)<=8)return-1;if(n=e.getUint16(i,!1),i+=2,65505===n)return me(e,i);if(65280!=(65280&n))return null;i+=e.getUint16(i,!1)}}(r.result)||-1)},r.readAsArrayBuffer(t.slice(0,262144))})},ye=1,ve=2,Ee=function(t,e){var n=t.width,r=n*e;r>t.height&&(n=(r=t.height)/e);var i=.5*(t.width-n),o=.5*(t.height-r);return Ut(i,o,n,r)},we=function(t,e,n,r){var i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,a=2*i*t.width,c=2*o*t.height,u=function(t,e){var n=t.width,r=t.height,i=Xt(n,e),o=Xt(r,e),a=Vt(t),c=At(a.tl.x+Math.abs(i.x),a.tl.y-Math.abs(i.y)),u=At(a.tr.x+Math.abs(o.y),a.tr.y+Math.abs(o.x)),l=At(a.bl.x-Math.abs(o.y),a.bl.y-Math.abs(o.x));return{width:Rt(c,u),height:Rt(c,l)}}(e,n);return Math.max(u.width/a,u.height/c)},_e=function(t,e,n){var r=t.center,i=t.zoom,o=t.aspectRatio,a=Dt(e),c={x:a.x-n.width*r.x,y:a.y-n.height*r.y},u=2*Math.PI+t.rotation%(2*Math.PI),l=we(n,Ee(e,o||n.height/n.width),u,r);return{origin:{x:r.x*n.width,y:r.y*n.height},translation:c,scale:i*l,rotation:t.rotation}};function be(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Oe(t,e,n[e])})}return t}function Oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Te=function(t){return{origin:be({},t.origin),translation:be({},t.translation),rotation:t.rotation,scale:t.scale}};function Re(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){xe(t,e,n[e])})}return t}function xe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ie=function(t,e,n,r){var i,o,a,c=n.translation,u=n.scale,l=n.rotation,s=n.origin,f={origin:Re({},s),translation:Re({},c),scale:u,rotation:2*Math.PI+l%(2*Math.PI)},h=t.height/t.width,d={x:s.x+c.x,y:s.y+c.y},p=Zt(e,f.rotation),m=It(p.tl,-f.rotation,d),g=It(p.tr,-f.rotation,d),y=It(p.br,-f.rotation,d),v=It(p.bl,-f.rotation,d),E={x:Math.min(m.x,g.x,y.x,v.x),y:Math.min(m.y,g.y,y.y,v.y),width:Math.max(m.x,g.x,y.x,v.x)-Math.min(m.x,g.x,y.x,v.x),height:Math.max(m.y,g.y,y.y,v.y)-Math.min(m.y,g.y,y.y,v.y)},w=Ut(E.x,E.y,E.width,E.height),_=Dt(w),b=Lt(w),O=Wt(t,n),T=Dt(O),R={x:O.x,y:O.y},x={x:T.x,y:T.y},I=_.x,A=_.y,C={x:R.x,y:R.y,width:O.width,height:O.height};if(i=O,o=Lt(w),a=Lt(i),!(o.left>=a.left&&o.top>=a.top&&o.bottom<=a.bottom&&o.right<=a.right))if("moving"===r){C.y>w.y?C.y=w.y:C.y+C.height<b.bottom&&(C.y=b.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<b.right&&(C.x=b.right-C.width);var M=Wt(t,Re({},n,{scale:f.scale})),S=Dt(M);x.x=S.x,x.y=S.y,R.x=M.x,R.y=M.y,C.x=x.x-.5*C.width,C.y=x.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<b.bottom&&(C.y=b.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<b.right&&(C.x=b.right-C.width);var P={x:C.x-R.x,y:C.y-R.y},L={x:P.x*Math.cos(f.rotation)-P.y*Math.sin(f.rotation),y:P.x*Math.sin(f.rotation)+P.y*Math.cos(f.rotation)};f.translation.x+=L.x,f.translation.y+=L.y}else if("resizing"===r){O.width<w.width&&(C.width=w.width,C.height=C.width*h,C.height<w.height&&(C.height=w.height,C.width=C.height/h)),O.height<w.height&&(C.height=w.height,C.width=C.height/h,C.width<w.width&&(C.width=w.width,C.height=C.width*h)),C.x=x.x-.5*C.width,C.y=x.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<b.bottom&&(C.y=b.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<b.right&&(C.x=b.right-C.width),f.scale=we(t,e,f.rotation,{x:(I-C.x)/C.width,y:(A-C.y)/C.height});var G=Wt(t,Re({},n,{scale:f.scale})),D=Dt(G);x.x=D.x,x.y=D.y,R.x=G.x,R.y=G.y,C.x=x.x-.5*C.width,C.y=x.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<b.bottom&&(C.y=b.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<b.right&&(C.x=b.right-C.width);var V={x:C.x-R.x,y:C.y-R.y},U={x:V.x*Math.cos(f.rotation)-V.y*Math.sin(f.rotation),y:V.x*Math.sin(f.rotation)+V.y*Math.cos(f.rotation)};f.translation.x+=U.x,f.translation.y+=U.y}else if("rotating"===r){var N=!1;if(C.y>w.y){var k=C.y-w.y;C.y=w.y,C.height+=2*k,N=!0}if(C.y+C.height<b.bottom){var j=b.bottom-(C.y+C.height);C.y=b.bottom-C.height,C.height+=2*j,N=!0}if(C.x>w.x){var z=C.x-w.x;C.x=w.x,C.width+=2*z,N=!0}if(C.x+C.width<b.right){var B=b.right-(C.x+C.width);C.x=b.right-C.width,C.width+=2*B,N=!0}N&&(f.scale=we(t,e,f.rotation,{x:(I-O.x)/O.width,y:(A-O.y)/O.height}))}return Re({},f,{rotation:n.rotation})},Ae={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},Ce=function(t,e){return Ae[t](e)};function Me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Se=function(t,e,n){var r=n.origin,i=n.translation,o=2*Math.PI+n.rotation%(2*Math.PI),a=Wt(t,n),c={x:r.x+i.x,y:r.y+i.y},u=Zt(e,o),l=It(u.tl,-o,c),s=It(u.tr,-o,c),f=It(u.br,-o,c),h={x:Math.min(l.x,s.x,f.x),y:Math.min(l.y,s.y,f.y),width:Math.max(l.x,s.x,f.x)-Math.min(l.x,s.x,f.x),height:Math.max(l.y,s.y,f.y)-Math.min(l.y,s.y,f.y)},d=Ut(h.x,h.y,h.width,h.height),p=Lt(d),m=Lt(a),g=a;if(p.top<m.top||p.right>m.right||p.bottom>m.bottom||p.left<m.left){var y=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Me(t,e,n[e])})}return t}({},m);if(p.top<=y.top){var v=y.bottom-y.top,E=y.right-y.left,w=Math.max(1,d.height/v),_=v*w,b=E*w-E;y.bottom=p.top+_,y.top=p.top,y.left-=.5*b,y.right+=.5*b}if(p.bottom>=y.bottom){var O=y.bottom-y.top,T=y.right-y.left,R=Math.max(1,d.height/O),x=O*R,I=T*R-T;y.bottom=p.bottom,y.top=p.bottom-x,y.left-=.5*I,y.right+=.5*I}if(p.left<=y.left){var A=y.bottom-y.top,C=y.right-y.left,M=Math.max(1,d.width/C),S=C*M,P=A*M-A;y.right=p.left+S,y.left=p.left,y.top-=.5*P,y.bottom+=.5*P}if(p.right>=y.right){var L=y.bottom-y.top,G=y.right-y.left,D=Math.max(1,d.width/G),V=G*D,U=L*D-L;y.right=p.right,y.left=p.right-V,y.top-=.5*U,y.bottom+=.5*U}g=Ut(y.left,y.top,y.right-y.left,y.bottom-y.top)}var N=Vt(g),k=Dt(g),j=It(N.tl,o,c),z=It(N.br,o,c),B=j.x+.5*(z.x-j.x),Y=j.y+.5*(z.y-j.y),F=Mt(g,{x:B-k.x,y:Y-k.y}),q=Mt(d,{x:B-k.x,y:Y-k.y}),W=Dt(q),X={x:F.x,y:F.y},Z=F.width,H=F.height,K=(W.x-X.x)/Z,Q=(W.y-X.y)/H,J=Z/t.width,$={x:K*t.width,y:Q*t.height},tt=1-J,et=$.x*tt,nt=$.y*tt,rt={x:X.x+Z*K,y:X.y+H*Q},it=It(X,o,{x:X.x+.5*Z,y:X.y+.5*H}),ot=It(X,o,rt),at=it.x-ot.x,ct=it.y-ot.y;return{origin:$,translation:{x:X.x-et+at,y:X.y-nt+ct},scale:J,rotation:n.rotation}},Pe={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},Le=function(t,e){return Pe[t](e)},Ge=Math.PI/2,De=Math.PI/4,Ve=function(t){var e=bt(De),n=bt(Ge),r=t/n,i=Math.floor(r)*n,o=t-i;return o>e&&(o-=n,i+=n),{main:i,sub:o}},Ue=function(t){return new Promise(function(e,n){var r=new Image;r.src=URL.createObjectURL(t),r.onerror=function(t){clearInterval(i),n(t)};var i=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(i),URL.revokeObjectURL(r.src),e({width:r.naturalWidth,height:r.naturalHeight}))},1)})},Ne=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var r=t.height/t.width,i=e.width/t.width,o=e.height/t.height;i<o?(n.width=t.width*i,n.height=n.width*r):(n.height=t.height*o,n.width=n.height/r)}return n},ke={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},je=function(t){return t&&(t.horizontal||t.vertical)},ze=function(t,e,n){if(e<=1&&!je(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),i=t.naturalWidth,o=t.naturalHeight,a=e>=5&&e<=8;a?(r.width=o,r.height=i):(r.width=i,r.height=o);var c=r.getContext("2d");if(e&&c.transform.apply(c,function(t,e,n){return-1===n&&(n=1),ke[n](t,e)}(i,o,e)),je(n)){var u=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(u[0]=-1,u[4]=i),(!a&&n.vertical||a&&n.horizontal)&&(u[3]=-1,u[5]=o),c.transform.apply(c,u)}return c.drawImage(t,0,0,i,o),r};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),i=n.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))})}}));var Be=function(){var t={resize:function(t,e){var r=e.mode,a=void 0===r?"contain":r,c=e.upscale,u=void 0!==c&&c,l=e.width,s=e.height,f=e.matrix;if(f=!f||i(f)?null:f,!l&&!s)return o(t,f);null===l?l=s:null===s&&(s=l);if("force"!==a){var h=l/t.width,d=s/t.height,p=1;if("cover"===a?p=Math.max(h,d):"contain"===a&&(p=Math.min(h,d)),p>1&&!1===u)return o(t,f);l=t.width*p,s=t.height*p}for(var m=t.width,g=t.height,y=Math.round(l),v=Math.round(s),E=t.data,w=new Uint8ClampedArray(y*v*4),_=m/y,b=g/v,O=Math.ceil(.5*_),T=Math.ceil(.5*b),R=0;R<v;R++)for(var x=0;x<y;x++){for(var I=4*(x+R*y),A=0,C=0,M=0,S=0,P=0,L=0,G=0,D=(R+.5)*b,V=Math.floor(R*b);V<(R+1)*b;V++)for(var U=Math.abs(D-(V+.5))/T,N=(x+.5)*_,k=U*U,j=Math.floor(x*_);j<(x+1)*_;j++){var z=Math.abs(N-(j+.5))/O,B=Math.sqrt(k+z*z);if(B>=-1&&B<=1&&(A=2*B*B*B-3*B*B+1)>0){var Y=E[(z=4*(j+V*m))+3];G+=A*Y,M+=A,Y<255&&(A=A*Y/250),S+=A*E[z],P+=A*E[z+1],L+=A*E[z+2],C+=A}}w[I]=S/C,w[I+1]=P/C,w[I+2]=L/C,w[I+3]=G/M,f&&n(I,w,f)}return{data:w,width:y,height:v}},filter:o},e=function(e,n){var r=e.transforms,i=null;if(r.forEach(function(t){"filter"===t.type&&(i=t)}),i){var o=null;r.forEach(function(t){"resize"===t.type&&(o=t)}),o&&(o.data.matrix=i.data,r=r.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(r,e.imageData))};function n(t,e,n){for(var r=0,i=0,o=0,a=e[t]/255,c=e[t+1]/255,u=e[t+2]/255,l=e[t+3]/255;r<4;r++)o=255*(a*n[i=5*r]+c*n[i+1]+u*n[i+2]+l*n[i+3]+n[i+4]),e[t+r]=Math.max(0,Math.min(o,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var r=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function i(t){return self.JSON.stringify(t||[])===r}function o(t,e){if(!e||i(e))return t;for(var n=t.data,r=n.length,o=e[0],a=e[1],c=e[2],u=e[3],l=e[4],s=e[5],f=e[6],h=e[7],d=e[8],p=e[9],m=e[10],g=e[11],y=e[12],v=e[13],E=e[14],w=e[15],_=e[16],b=e[17],O=e[18],T=e[19],R=0,x=0,I=0,A=0,C=0;R<r;R+=4)x=n[R]/255,I=n[R+1]/255,A=n[R+2]/255,C=n[R+3]/255,n[R]=Math.max(0,Math.min(255*(x*o+I*a+A*c+C*u+l),255)),n[R+1]=Math.max(0,Math.min(255*(x*s+I*f+A*h+C*d+p),255)),n[R+2]=Math.max(0,Math.min(255*(x*m+I*g+A*y+C*v+E),255)),n[R+3]=Math.max(0,Math.min(255*(x*w+I*_+A*b+C*O+T),255));return t}},Ye=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var r=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,r);var i=t.getUint16(e,r);e+=2;for(var o=0;o<i;o++)if(274===t.getUint16(e+12*o,r))return t.setUint16(e+12*o+8,1,r),!0;return!1}},Fe=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,r,i=2,o=!1;i<e.byteLength&&(n=e.getUint16(i,!1),r=e.getUint16(i+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=Ye(e,i)),!(i+r>e.byteLength));)i+=r;return t.slice(0,i)}(r.result)||null)},r.readAsArrayBuffer(t.slice(0,262144))})},qe=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var r=new n;return r.append(t),r.getBlob(e)}return new Blob([t],{type:e})},We=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var i=Math.random().toString(36).substr(2,9);r.onmessage=function(t){t.data.id===i&&e(t.data.message)},r.postMessage({id:i,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Xe=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,i){if(!t||!function(t){return/^image/.test(t.type)}(t))return i();var o=n.stripImageHead,a=n.beforeCreateBlob,c=n.afterCreateBlob,u=n.canvasMemoryLimit,l=e.crop,s=e.size,f=e.filter,h=e.output,d=e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,p=h.quality,m=null===p?null:p/100,g=h.type,y=[];"number"!=typeof s.width&&"number"!=typeof s.height||y.push({type:"resize",data:s}),f&&20===f.length&&y.push({type:"filter",data:f});var v=function(t){var e=c?c(t):t;Promise.resolve(e).then(r)},E=function(t,e){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r){var i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0);var o=n?n(i):i;Promise.resolve(o).then(function(t){t.toBlob(r,e.type,e.quality)})})}(t,e,a).then(function(t){if(o)return v(t);Fe(t).then(function(e){null!==e&&(t=new Blob([e,t.slice(20)],{type:t.type})),v(t)})}).catch(i)};if(/svg/.test(t.type)&&null===g)return function(t,e){return new Promise(function(n){var r=new FileReader;r.onloadend=function(){var t=r.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=t;var o=i.querySelector("svg");document.body.appendChild(i);var a=o.getBBox();i.parentNode.removeChild(i);var c=i.querySelector("title"),u=o.getAttribute("viewBox")||"",l=o.getAttribute("width")||"",s=o.getAttribute("height")||"",f=parseFloat(l)||null,h=parseFloat(s)||null,d=(l.match(/[a-z]+/)||[])[0]||"",p=(s.match(/[a-z]+/)||[])[0]||"",m=u.split(" ").map(parseFloat),g=m.length?{x:m[0],y:m[1],width:m[2],height:m[3]}:a,y=null!=f?f:g.width,v=null!=h?h:g.height;o.style.overflow="visible",o.setAttribute("width",y),o.setAttribute("height",v);var E=e.aspectRatio||v/y,w=y,_=w*E,b=qt({width:y,height:v},kt({width:w,height:_},E),e.rotation,e.center),O=e.zoom*b,T=e.rotation*(180/Math.PI),R={x:.5*w,y:.5*_},x={x:R.x-y*e.center.x,y:R.y-v*e.center.y},I=["rotate(".concat(T," ").concat(R.x," ").concat(R.y,")"),"translate(".concat(R.x," ").concat(R.y,")"),"scale(".concat(O,")"),"translate(".concat(-R.x," ").concat(-R.y,")"),"translate(".concat(x.x," ").concat(x.y,")")],A=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-y:0," ").concat(e.flip.vertical?-v:0,")")],C='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(w).concat(d,'" height="').concat(_).concat(p,'" \nviewBox="0 0 ').concat(w," ").concat(_,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: PQINA - https://pqina.nl/ --\x3e\n<title>').concat(c?c.textContent:"",'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(I.join(" "),'">\n<g transform="').concat(A.join(" "),'">\n').concat(o.outerHTML,"\n</g>\n</g>\n</svg>");n(C)},r.readAsText(t)})}(t,l).then(function(t){r(qe(t,"image/svg+xml"))});var w=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})})(w).then(function(e){URL.revokeObjectURL(w);var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).canvasMemoryLimit,i=n.zoom||1,o=ze(t,e,n.flip),a={width:o.width,height:o.height},c=n.aspectRatio||a.height/a.width,u=jt(a,c,i);if(r){var l=u.width*u.height;if(l>r){var s=Math.sqrt(r)/Math.sqrt(l);a.width=Math.floor(a.width*s),a.height=Math.floor(a.height*s),u=jt(a,c,i)}}var f=document.createElement("canvas"),h={x:.5*u.width,y:.5*u.height},d={x:0,y:0,width:u.width,height:u.height,center:h},p=i*qt(a,kt(d,c),n.rotation,n.center);f.width=Math.round(u.width/p),f.height=Math.round(u.height/p),h.x/=p,h.y/=p;var m=h.x-a.width*(n.center?n.center.x:.5),g=h.y-a.height*(n.center?n.center.y:.5),y=f.getContext("2d");return y.translate(h.x,h.y),y.rotate(n.rotation||0),y.drawImage(o,m-h.x,g-h.y,a.width,a.height),y.getImageData(0,0,f.width,f.height)}(e,d,l,{canvasMemoryLimit:u}),r={quality:m,type:g||t.type};if(!y.length)return E(n,r);var i=We(Be);i.post({transforms:y,imageData:n},function(t){E(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),r),i.terminate()},[n.data.buffer])})})},Ze=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},He=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(Ze(t.getMonth()+1,"00"),"-").concat(Ze(t.getDate(),"00"),"_").concat(Ze(t.getHours(),"00"),"-").concat(Ze(t.getMinutes(),"00"),"-").concat(Ze(t.getSeconds(),"00"))},Ke=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t("GET_CROP_ASPECT_RATIO"),o={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};n?Object.assign(o,n):e.options.crop?Object.assign(o,e.options.crop):o.aspectRatio=i;var a=r.width,c=r.height;if(a&&c)o.aspectRatio=c/a;else if(e.instructions.size){var u=e.instructions.size,l=u.width,s=u.height;o.aspectRatio=s/l}return o},Qe=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Je={jpeg:"jpg","svg+xml":"svg"},$e=function(t){return Array.isArray(t)&&20===t.length};function tn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function en(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function nn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){rn(t,e,n[e])})}return t}function rn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var on={contrast:function(t){return[t,0,0,0,.5*(1-t),0,t,0,0,.5*(1-t),0,0,t,0,.5*(1-t),0,0,0,1,0]},exposure:function(t){return[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0]},brightness:function(t){return[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0]},saturation:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0]}},an=Math.PI/2,cn=function(t){var e={upscale:t("GET_OUTPUT_UPSCALE"),mode:t("GET_OUTPUT_FIT"),width:t("GET_OUTPUT_WIDTH"),height:t("GET_OUTPUT_HEIGHT")},n=t("GET_SIZE_INPUT");if(t("ALLOW_MANUAL_RESIZE")&&(n.width||n.height)){var r=n.width,i=n.height,o=t("GET_CROP_RECTANGLE_ASPECT_RATIO");r&&!i?i=r/o:i&&!r&&(r=i*o),e.width=r,e.height=i,e.upscale=!0,e.mode="force"}return e},un=function(t,e,n){return new Promise(function(r,i){var o={data:null,file:null},a=Jt(e.image,e.crop),c=cn(n),u={crop:a,image:{orientation:e.file.orientation},size:c,output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY")},filter:e.colorMatrices.filter?{id:e.filterName,value:e.filterValue,matrix:e.colorMatrices.filter}:null,color:Object.keys(e.colorValues).length?Object.keys(e.colorValues).reduce(function(t,n){return t[n]={value:e.colorValues[n],matrix:e.colorMatrices[n].map(function(t){return bt(t,5)})},t},{}):null,colorMatrix:n("GET_COLOR_MATRIX")};if(t.data&&(o.data=u),t.file){var l={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),afterCreateBlob:n("GET_AFTER_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD"),canvasMemoryLimit:n("GET_OUTPUT_CANVAS_MEMORY_LIMIT")},s=e.file.data,f=nn({},u,{filter:u.colorMatrix});Xe(s,f,l).then(function(t){var e;o.file=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return i.lastModifiedDate=new Date,H(e)||(e=He()),e&&null===r&&e.split(".").pop()?i.name=e:(r=r||function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""}(i.type),i.name=e+(r?"."+r:"")),i}(t,function(t,e){var n=function(t){return t.substr(0,t.lastIndexOf("."))||t}(t),r=e.split("/")[1],i=Je[r]||r;return"".concat(n,".").concat(i)}(s.name,(e=t.type,/jpeg|png|svg\+xml/.test(e)?e:"image/jpeg"))),r(o)}).catch(i)}else r(o)})},ln=function(t){t.crop.draft.rotateMinScale=null},sn=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)}(t);var i=nn({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.draft.transforms=wn(t.image,t.crop.rectangle,i,e.main+e.sub,n,t.crop.draft.transforms?t.crop.draft.transforms.rotation:t.crop.rotation.main+t.crop.rotation.sub,r),t.crop.rotation=Ve(t.crop.draft.transforms.rotation)},fn=function(t,e,n){if(null!==t.stage){gn(t),t.size.width=!!t.instructions.size&&t.instructions.size.width,t.size.height=!!t.instructions.size&&t.instructions.size.height,t.size.aspectRatioLocked=!0,t.size.aspectRatioPrevious=!1,t.crop.rectangle=Ee(t.stage,t.instructions.crop.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null,t.crop.transforms=_e(t.instructions.crop,t.stage,t.image),t.crop.draft.transforms=null,t.crop.rotation=Ve(t.instructions.crop.rotation),t.crop.flip=nn({},t.instructions.crop.flip);var r=e("GET_CROP_ASPECT_RATIO_OPTIONS")||[],i=r.map(function(t){return t.value}).find(function(e){return e===t.instructions.crop.aspectRatio}),o=r.find(function(t){return null===t.value});i?t.crop.aspectRatio=i:o&&r.length?t.crop.aspectRatio=null:t.crop.aspectRatio=e("GET_CROP_ASPECT_RATIO"),t.crop.isDirty=!1,Object.keys(t.instructions.color).forEach(function(e){return n("COLOR_SET_VALUE",{key:e,value:t.instructions.color[e]})}),n("FILTER_SET_VALUE",{value:t.instructions.filter}),ln(t)}},hn=function(t,e){if(t.stage){gn(t);var n=t.crop.rectangle,r=n.height/n.width,i=t.crop.aspectRatio;if(null!==i&&bt(r,3)!==i){var o=e("GET_MIN_CROP_SIZE");o.width=bt(o.width),o.height=bt(o.height);var a=Math.min(n.width,n.height);Math.min(a*i,a/i)<Math.max(o.width,o.height)&&(t.crop.rectangle=function(t,e,n){var r=Pt(t);return r.width=Math.min(r.height,r.width),r.height=r.width,r.height=r.width*e,r.height<n.height&&(r.height=n.height,r.width=r.height/e),r.width<n.width&&(r.width=n.width,r.height=r.width*e),r}(nn({},t.crop.rectangle),i,o),t.crop.draft.transforms=Se(t.image,t.crop.rectangle,t.crop.transforms))}var c=t.crop.draft.transforms||t.crop.transforms,u=Ht(t.image,t.crop.rectangle,c);t.crop.aspectRatio&&(u.aspectRatio=t.crop.aspectRatio),t.crop.transforms=_e(u,t.stage,t.image),t.crop.draft.transforms=null;var l=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=Ee(t.stage,l),t.crop.draft.rectangle=null,ln(t)}},dn=function(t){var e,n,r,i,o,a,c,u,l,s,f,h,d,p,m,g,y,v,E,w,_,b,O,T,R,x,I,A,C,M,S,P,L,G,D,V,U,N,k;t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms||t.crop.transforms,t.crop.transforms.interaction=null,t.crop.draft.transforms=null,t.crop.transforms=nn({},t.crop.transforms,(e=t.image,n=t.crop.rectangle,r=t.crop.transforms,i=r.origin,o=r.translation,a=r.scale,c=2*Math.PI+r.rotation%(2*Math.PI),u={x:i.x+o.x,y:i.y+o.y},l=Zt(n,c),s=It(l.tl,-c,u),f=It(l.tr,-c,u),h=It(l.br,-c,u),d=It(l.bl,-c,u),p=Ut(Math.min(s.x,f.x,h.x,d.x),Math.min(s.y,f.y,h.y,d.y),Math.max(s.x,f.x,h.x,d.x)-Math.min(s.x,f.x,h.x,d.x),Math.max(s.y,f.y,h.y,d.y)-Math.min(s.y,f.y,h.y,d.y)),m=Ut(p.x,p.y,p.width,p.height),g=Wt(e,r),y=Vt(g),v=Dt(g),E=It(y.tl,c,u),w=It(y.br,c,u),_=E.x+.5*(w.x-E.x),b=E.y+.5*(w.y-E.y),O=Mt(g,{x:_-v.x,y:b-v.y}),T=Mt(m,{x:_-v.x,y:b-v.y}),R=Dt(T),x={x:O.x,y:O.y},I=O.width,A=O.height,C=(R.x-x.x)/I,M=(R.y-x.y)/A,S={x:C*e.width,y:M*e.height},L=S.x*(P=1-a),G=S.y*P,D={x:x.x+I*C,y:x.y+A*M},V=It(x,c,{x:x.x+.5*I,y:x.y+.5*A}),U=It(x,c,D),N=V.x-U.x,k=V.y-U.y,{origin:Ot(S),translation:Ot({x:x.x-L+N,y:x.y-G+k})})),t.crop.isRotating=!1,t.crop.isDirty=!0},pn=function(t,e,n){var r=e("GET_CROP_ZOOM_TIMEOUT");r&&(clearTimeout(t.zoomTimeoutId),t.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},r))},mn=function(t,e,n){gn(t),pn(t,e,n)},gn=function(t){clearTimeout(t.zoomTimeoutId)},yn=function(t){t.crop.rectangle=t.crop.draft.rectangle.limited,t.crop.draft.rectangle=null,dn(t),ln(t)},vn=function(t){t.crop.draft.transforms=Te(t.crop.transforms),t.crop.draft.rectangle={limited:Pt(t.crop.rectangle),free:Pt(t.crop.rectangle)},gn(t)},En=function(t,e){return Math.min(t.width/e.width,t.height/e.height)},wn=function(t,e,n,r,i,o,a){var c=Ie(t,e,nn({},Te(n),{rotation:r}),"rotating"),u=En(e,i);return bt(c.scale,5)>bt(u,5)?(a&&(o+=2*a),nn({},Te(n),{rotation:o,interaction:{rotation:c.rotation}})):(c.scale=Math.min(u,c.scale),c.interaction={rotation:c.rotation},c)},_n=function(t,e,n,r,i){var o=Math.max(1e-10,r),a=Ie(t,e,nn({},Te(n),{scale:o}),"resizing"),c=En(e,i);return a.scale=Math.min(c,a.scale),a.interaction={scale:o},a},bn=function(t){return!1===t.file},On=function(t,e,n){return nn({AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){t("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){t("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(e){t("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=e},DID_SET_SRC:function(e){e.value!==e.prevValue&&(clearTimeout(n.noImageTimeout),t("REQUEST_LOAD_IMAGE",{source:e.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var e=n.queuedFile;n.queuedFile=null,t("REQUEST_LOAD_IMAGE",e)}},REQUEST_LOAD_IMAGE:function(e){var r,i=e.source,o=e.success,a=void 0===o?function(){}:o,c=e.failure,u=void 0===c?function(t){}:c,l=e.options,s=e.resolveOnConfirm,f=void 0!==s&&s;if(clearTimeout(n.noImageTimeout),!i)return u();null===n.file?(ot(n),n.file={uid:st()},t("DID_REQUEST_LOAD_IMAGE"),(r=i,new Promise(function(t,e){if(H(r))fetch(r).then(function(t){if(t.ok)return t.blob();e(t)}).then(function(e){return t(e)});else if(r instanceof Blob)t(r);else{if("IMG"===r.nodeName){var n=function(e){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight,n.getContext("2d").drawImage(e,0,0),n.toBlob(t)};return r.complete?void n(r):void(r.onload=function(){return n(r)})}"CANVAS"!==r.nodeName?e(r):r.toBlob(t)}})).then(function(e){if(bn(n))return t("ABORT_IMAGE");e.name||(e.name=He()),n.file.orientation=-1,n.file.data=e,t("LOAD_IMAGE",{success:a,failure:u,options:l,resolveOnConfirm:f},!0),t("KICK")}).catch(function(e){if(bn(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_LOAD_ERROR",data:e}}),u(e)})):t("REQUEST_ABORT_IMAGE",{source:i,success:a,failure:u,options:l,resolveOnConfirm:f})},LOAD_IMAGE:function(r){var i=r.success,o=r.failure,a=r.options,c=void 0===a?{}:a,u=r.resolveOnConfirm;if(bn(n))return t("ABORT_IMAGE");var l=n.file.data;Promise.all([Ue(l),ge(l)]).then(function(r){if(bn(n))return t("ABORT_IMAGE");var a=r[0],l=r[1];n.file.orientation=l;var s=a.width,f=a.height;l>=5&&l<=8?(a.width=f,a.height=s):(a.width=s,a.height=f);var h=e("GET_MIN_IMAGE_SIZE");if(a.width<h.width||a.height<h.height)return t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_MIN_SIZE_VALIDATION_ERROR",data:{size:a,minImageSize:h}}}),ot(n),void o();var d=Ne(a,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});if(n.image={x:0,y:0,width:d.width,height:d.height,naturalWidth:a.width,naturalHeight:a.height,aspectRatio:a.height/a.width},e("ALLOW_MANUAL_RESIZE")&&c.size&&(n.size.width=c.size.width,n.size.height=c.size.height,n.size.aspectRatioLocked=!0,n.size.aspectRatioPrevious=!1,n.instructions.size={width:c.size.width,height:c.size.height}),n.instructions.crop=Ke(e,n,c.crop?nn({},c.crop):null,n.size),void 0===c.filter)n.instructions.filter=n.options.filter;else{var p=c.filter;n.instructions.filter=null===p?p:p.id||p.matrix||p}n.instructions.color=Object.keys(on).reduce(function(t,e){return t[e]=c.color&&void 0!==c.color[e]?"number"==typeof c.color[e]?c.color[e]:c.color[e].value:n.options["color".concat(Qe(e))],t},{}),t("DID_LOAD_IMAGE",{image:nn({size:n.file.data.size,name:n.file.data.name,type:n.file.data.type,orientation:l},a)}),n.filePromise={resolveOnConfirm:u,success:i,failure:o}}).catch(function(e){if(bn(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_UNKNOWN_ERROR",data:e}}),ot(n),o()})},CHANGE_VIEW:function(e){var r=e.id;n.activeView=r,t("SHOW_VIEW",{id:r})},UPDATE_ROOT_RECT:function(t){var e=t.rect;n.rootRect=e},DID_RESIZE_STAGE:function(r){var i=r.size,o=r.offset,a=r.animate,c=null===n.stage;if(n.stage=Ut(0,0,i.width,i.height),n.stageOffset=At(o.x,o.y),!e("GET_ALLOW_PREVIEW_FIT_TO_VIEW")){var u=Math.min(i.width,n.image.naturalWidth),l=Math.min(i.height,n.image.naturalHeight);n.stage=Ut(0,0,u,l),n.stageOffset=At(o.x+.5*i.width-.5*u,o.y+.5*i.height-.5*l)}if(c){if(fn(n,e,t),!n.filePromise.resolveOnConfirm){var s=Jt(n.image,n.crop),f=cn(e);n.filePromise.success({crop:s,image:{orientation:n.file.orientation},size:f,output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})}}else n.instantUpdate=!a,hn(n,e),setTimeout(function(){n.instantUpdate=!1},16)},RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK:function(t){var e=t.value;n.size.aspectRatioLocked=e},RESIZE_SET_OUTPUT_SIZE:function(r){var i=r.width,o=r.height,a=te({width:i=i||null,height:o=o||null},e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),e("GET_CROP_RECTANGLE_ASPECT_RATIO"));if(n.size.width=a.width?Math.round(a.width):null,n.size.height=a.height?Math.round(a.height):null,i&&o){var c=o/i;if(c===n.crop.aspectRatio)return;!1===n.size.aspectRatioPrevious&&(n.size.aspectRatioPrevious=n.crop.aspectRatio),t("CROP_SET_ASPECT_RATIO",{value:c})}else!1!==n.size.aspectRatioPrevious&&(t("CROP_SET_ASPECT_RATIO",{value:n.size.aspectRatioPrevious}),n.size.aspectRatioPrevious=!1)},CROP_SET_ASPECT_RATIO:function(t){var r=t.value;if(gn(n),n.crop.aspectRatio=r,n.crop.aspectRatio&&hn(n,e),n.crop.isDirty=!0,n.size.width&&n.size.height)if(n.crop.aspectRatio){var i=n.size.width*n.crop.aspectRatio,o=_t(i,e("GET_SIZE_MIN").height,e("GET_SIZE_MAX").height);n.size.height=o,n.size.width=o/n.crop.aspectRatio}else n.size.height=null},CROP_ZOOM:function(){n.stage&&(gn(n),hn(n,e))},CROP_RECT_CORNER_DRAG_RELEASE:function(){return yn(n)||pn(n,e,t)},CROP_RECT_EDGE_DRAG_RELEASE:function(){return yn(n)||pn(n,e,t)},CROP_IMAGE_RESIZE_GRAB:function(){return vn(n)||gn(n)},CROP_IMAGE_ROTATE_GRAB:function(){vn(n),gn(n),n.crop.isRotating=!0},CROP_RECT_EDGE_DRAG_GRAB:function(){return vn(n)||gn(n)},CROP_RECT_CORNER_DRAG_GRAB:function(){return vn(n)||gn(n)},CROP_RECT_EDGE_DRAG:function(t){var r=t.offset,i=t.origin,o=t.anchor,a=n.image,c=n.stage,u=/n|s/.test(i)?ve:ye,l=Ce(i,n.crop.rectangle),s=Ce(o,n.crop.rectangle),f=xt({x:l.x+(u===ye?r.x:0),y:l.y+(u===ve?r.y:0)},c),h=e("GET_MIN_CROP_SIZE"),d=e("GET_MAX_CROP_SIZE");h.width=bt(h.width),h.height=bt(h.height);var p=En(n.crop.rectangle,e("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);d.width=bt(d.width*p),d.height=bt(d.height*p);var m={x:Math.sign(l.x-s.x),y:Math.sign(l.y-s.y)};n.crop.draft.rectangle=function(t,e,n,r,i,o,a,c,u){var l=o.left,s=o.right,f=o.top,h=o.bottom,d=s-l,p=h-f,m=i.left,g=i.right,y=i.top,v=i.bottom;if(n===ve){if(y=t.y>0?r.y:Math.min(r.y,Math.max(e.y,f)),v=t.y>0?Math.max(r.y,Math.min(e.y,h)):r.y,a){var E=(v-y)/a;m=r.x-.5*E,g=r.x+.5*E}}else if(m=t.x>0?r.x:Math.min(r.x,Math.max(e.x,l)),g=t.x>0?Math.max(r.x,Math.min(e.x,s)):r.x,a){var w=(g-m)*a;y=r.y-.5*w,v=r.y+.5*w}var _,b,O,T,R=c.width,x=c.height;if(n===ve?(_=r.x-.5*R,b=r.x+.5*R,t.y<0?(O=r.y-x,T=r.y):t.y>0&&(O=r.y,T=r.y+x)):(O=r.y-.5*x,T=r.y+.5*x,t.x<0?(_=r.x-R,b=r.x):t.x>0&&(_=r.x,b=r.x+R)),a)if(n===ve){var I=Math.min((v-y)/a,d),A=I*a;m<l&&(g=(m=l)+I),g>s&&(m=(g=s)-I),r.x=m+.5*I,t.y<0?y=r.y-A:t.y>0&&(v=r.y+A)}else{var C=Math.min((g-m)*a,p),M=C/a;y<f&&(v=(y=f)+C),v>h&&(y=(v=h)-C),r.y=y+.5*C,t.x<0?m=r.x-M:t.x>0&&(g=r.x+M)}var S=Gt({top:y,right:g,bottom:v,left:m}),P=function(){var e=R*a;n===ye?(y=r.y-.5*e,v=r.y+.5*e):t.y<0?(v=r.y,y=v-e):t.y>0&&(y=r.y,v=y+e)},L=function(){var e=x/a;n===ve?(m=r.x-.5*e,g=r.x+.5*e):t.x<0?(g=r.x,m=g-e):t.x>0&&(m=r.x,g=m+e)};g<b&&(g=b,m=b-R,a&&P()),m>_&&(m=_,g=_+R,a&&P()),y>O&&(y=O,v=O+x,a&&L()),v<T&&(v=T,y=T-x,a&&L());var G=u.width,D=u.height;if(a&&(a<1?G=D/a:D=G*a),g-m>G&&(t.x<0?m=r.x-G:g=r.x+G),v-y>D&&(t.y<0?y=r.y-D:v=r.y+D),g-m==0&&(t.x>0?g=r.x+2:m=r.x-2),v-y==0&&(t.y>0?v=r.y+2:y=r.y-2),Math.round(m)<l||Math.round(g)>s||Math.round(y)<f||Math.round(v)>h){var V=h-f,U=s-l;if(m<l){m=l;var N=Math.min(g-m,U);g=m+N}if(g>s){g=s;var k=Math.min(g-m,U);m=g-k}if(y<f){y=f;var j=Math.min(v-y,V);v=y+j}if(v>h){v=h;var z=Math.min(v-y,V);y=v-z}S=Gt({top:y,right:g,bottom:v,left:m})}return{free:S,limited:Gt({top:y,right:g,bottom:v,left:m})}}(m,f,u,s,Lt(n.crop.rectangle),Lt(c),n.crop.aspectRatio,h,d),n.crop.draft.transforms=Se(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_RECT_CORNER_DRAG:function(t){var r=t.offset,i=t.origin,o=t.anchor,a=n.image,c=n.stage,u=Le(i,n.crop.rectangle),l=Le(o,n.crop.rectangle),s={x:u.x+r.x,y:u.y+r.y},f=e("GET_MIN_CROP_SIZE"),h=e("GET_MAX_CROP_SIZE");f.width=bt(f.width),f.height=bt(f.height);var d=En(n.crop.rectangle,e("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);h.width=bt(h.width*d),h.height=bt(h.height*d);var p={x:Math.sign(u.x-l.x),y:Math.sign(u.y-l.y)};n.crop.draft.rectangle=function(t,e,n,r,i,o,a){var c=Lt(r),u=c.left,l=c.right,s=c.top,f=c.bottom,h=xt({x:e.x,y:e.y},r),d=t.x>0?n.x:Math.min(h.x,n.x),p=t.x>0?Math.max(n.x,h.x):n.x,m=t.y>0?n.y:Math.min(h.y,n.y),g=t.y>0?Math.max(n.y,h.y):n.y;if(i){var y=h.x-n.x;t.x>0?p=Math.max(n.x,n.x+t.x*y):d=Math.min(n.x,n.x-t.x*y),t.y>0?g=Math.max(n.y,n.y+t.x*y*i):m=Math.min(n.y,n.y-t.x*y*i)}var v=Gt({top:m,right:p,bottom:g,left:d});Gt({top:m,right:p,bottom:g,left:d});if(o.width&&o.height){var E=o.width,w=o.height;i&&(1===i?w=E=Math.max(E,w):E<w?E=w/i:E>w?w=E*i:E=w/i),p-d<E&&(t.x>0?p=n.x+E:d=n.x-E),g-m<w&&(t.y>0?g=n.y+w:m=n.y-w);var _=a.width,b=a.height;i&&(i<1?_=b/i:b=_*i),p-d>_&&(t.x<0?d=n.x-_:p=n.x+_),g-m>b&&(t.y<0?m=n.y-b:g=n.y+b)}if(p-d==0&&(t.x>0?p=n.x+2:d=n.x-2),g-m==0&&(t.y>0?g=n.y+2:m=n.y-2),Math.round(d)<u||Math.round(p)>l||Math.round(m)<s||Math.round(g)>f){var O=f-s,T=l-u;if(d<u){d=u;var R=Math.min(p-d,T);p=d+R,i&&(t.y>0&&(g=n.y+R*i),t.y<0&&(m=n.y-R*i))}if(p>l){p=l;var x=Math.min(p-d,T);d=p-x,i&&(t.y>0&&(g=n.y+x*i),t.y<0&&(m=n.y-x*i))}if(m<s){m=s;var I=Math.min(g-m,O);g=m+I,i&&(t.x>0&&(p=n.x+I/i),t.x<0&&(d=n.x-I/i))}if(g>f){g=f;var A=Math.min(g-m,O);m=g-A,i&&(t.x>0&&(p=n.x+A/i),t.x<0&&(d=n.x-A/i))}v=Gt({top:m,right:p,bottom:g,left:d})}return{free:v,limited:Gt({top:m,right:p,bottom:g,left:d})}}(p,s,l,c,n.crop.aspectRatio,f,h),n.crop.draft.transforms=Se(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_IMAGE_DRAG_GRAB:function(){return vn(n)||gn(n)},CROP_IMAGE_DRAG_RELEASE:function(){dn(n),ln(n),pn(n,e,t)},CROP_IMAGE_RESIZE_RELEASE:function(){dn(n),ln(n),pn(n,e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){dn(n),pn(n,e,t)},CROP_IMAGE_DRAG:function(t){var e,r,i,o,a,c,u=t.value;gn(n),n.crop.draft.transforms=(e=n.image,r=n.crop.rectangle,i=n.crop.transforms,o=u,a={x:i.translation.x+o.x,y:i.translation.y+o.y},(c=Ie(e,r,nn({},Te(i),{translation:a}),"moving")).interaction={translation:a},c)},CROP_IMAGE_RESIZE:function(t){var r=t.value;gn(n);var i=n.crop.transforms;n.crop.draft.transforms=_n(n.image,n.crop.rectangle,i,i.scale+i.scale*r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var r=t.value;gn(n);var i=n.crop.transforms;n.crop.draft.transforms=_n(n.image,n.crop.rectangle,i,i.scale*r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_AMOUNT:function(t){var r=t.value;gn(n);var i=n.crop.transforms;n.crop.draft.transforms=_n(n.image,n.crop.rectangle,i,(n.crop.draft.transforms?n.crop.draft.transforms.scale:i.scale)+r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE:function(t){var r=t.value;gn(n),n.crop.isRotating=!0,sn(n,{main:n.crop.rotation.main,sub:r},e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE_ADJUST:function(t){var r=t.value;gn(n),sn(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+r))},e("GET_MIN_PREVIEW_IMAGE_SIZE")),dn(n)},CROP_IMAGE_ROTATE_CENTER:function(){gn(n),sn(n,{main:n.crop.rotation.main,sub:0},e("GET_MIN_PREVIEW_IMAGE_SIZE")),dn(n)},CROP_IMAGE_ROTATE_LEFT:function(){mn(n,e,t),sn(n,{main:n.crop.rotation.main-an,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),-an),dn(n)},CROP_IMAGE_ROTATE_RIGHT:function(){mn(n,e,t),sn(n,{main:n.crop.rotation.main+an,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),an),dn(n)},CROP_IMAGE_FLIP_HORIZONTAL:function(){mn(n,e,t),0===bt(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){mn(n,e,t),0===bt(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_RECEIVE_IMAGE_DATA:function(t){var e=t.previewData,r=t.thumbData;n.file.preview=e,n.file.thumb=r},COLOR_SET_COLOR_VALUE:function(e){var r=e.key,i=e.value;n.crop.isDirty=!0,t("COLOR_SET_VALUE",{key:r,value:i})},COLOR_SET_VALUE:function(e){var r=e.key,i=e.value;n.colorValues[r]=i,t("SET_COLOR_MATRIX",{key:r,matrix:on[r](i)})}},Object.keys(on).reduce(function(r,i){var o=i.toUpperCase(),a=Qe(i);return r["SET_COLOR_".concat(o)]=function(r){var c=r.value;if(c!==r.prevValue){var u=en(e("GET_COLOR_".concat(o,"_RANGE")),2),l=u[0],s=u[1],f=_t(c,l,s);n.options["color".concat(a)]=f,n.instructions.color||(n.instructions.color={}),n.instructions.color[i]=f,t("COLOR_SET_VALUE",{key:i,value:f})}},r},{}),{SET_COLOR_MATRIX:function(e){var r=e.key,i=e.matrix;i?n.colorMatrices[r]=tn(i):delete n.colorMatrices[r],t("DID_SET_COLOR_MATRIX",{key:r,matrix:i})},FILTER_SET_FILTER:function(e){var r=e.value;n.crop.isDirty=!0,t("FILTER_SET_VALUE",{value:r})},FILTER_SET_VALUE:function(r){var i=r.value,o=$e(i)?i:null;if(H(i)){var a=e("GET_FILTERS");l(a,function(t,e){t===i&&(o=e.matrix())})}n.filter=i,n.filterName=H(i)?i:null,t("SET_COLOR_MATRIX",{key:"filter",matrix:o})},DID_SET_FILTER:function(e){var n=e.value;n!==e.prevValue&&(t("FILTER_SET_VALUE",{value:n}),t("SET_DATA",{filter:n}))},DID_SET_SIZE:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{size:n})},DID_SET_CROP:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{crop:n})},SET_DATA:function(r){if(r.size&&e("ALLOW_MANUAL_RESIZE")){var i=nn({width:null,height:null},r.size),o=te(i,e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),null);n.instructions.size=nn({},o),t("RESIZE_SET_OUTPUT_SIZE",o)}r.filter&&(n.instructions.filter=r.filter),n.instructions.color=Object.keys(on).reduce(function(t,e){return t[e]=void 0===r.color||void 0===r.color[e]?n.options["color".concat(Qe(e))]:r.color[e],t},{}),r.crop&&(n.instructions.crop=Ke(e,n,r.crop,n.size),t("EDIT_RESET"))},DID_SET_INITIAL_STATE:function(t){var r=t.value||{},i=r.crop,o=r.filter,a=r.color,c=r.size,u=nn({width:null,height:null},void 0===c?{}:c),l=te(u,e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),null);n.instructions.size=nn({},l),n.instructions.crop=Ke(e,n,i),n.instructions.filter=o||null,n.instructions.color=Object.keys(on).reduce(function(t,e){return t[e]=void 0===a||void 0===a[e]?n.options["color".concat(Qe(e))]:a[e],t},{}),n.crop.isDirty=!0},GET_DATA:function(r){var i=r.success,o=r.failure,a=r.file,c=r.data;if(n.file&&n.stage){var u={file:Z(a)?a:e("GET_OUTPUT_FILE"),data:Z(c)?c:e("GET_OUTPUT_DATA"),success:i,failure:o};t(u.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",u)}},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,r=e.data,i=e.success,o=e.failure;t("PREPARE_OUTPUT",{file:n,data:r,success:i,failure:o},!0),t("DID_REQUEST_PREPARE_OUTPUT")},PREPARE_OUTPUT:function(r){var i=r.file,o=r.data,a=r.success,c=void 0===a?function(){}:a,u=r.failure,l=void 0===u?function(){}:u;if(bn(n))return t("ABORT_IMAGE");un({file:i,data:o},n,e).then(function(e){if(t("DID_PREPARE_OUTPUT"),bn(n))return t("ABORT_IMAGE");c(e)}).catch(function(e){if(bn(n))return t("ABORT_IMAGE");l(e)})},EDIT_RESET:function(){gn(n),fn(n,e,t)},EDIT_CONFIRM:function(){if(n.file&&n.stage){gn(n),t("CROP_ZOOM");var r={file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})}};t(r.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",r)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),t("DID_CANCEL")},EDIT_CLOSE:function(){gn(n)},EDIT_DESTROY:function(){ot(n)},SET_OPTIONS:function(e){var n=e.options;l(n,function(e,n){t("SET_".concat(at(e,"_").toUpperCase()),{value:n})})}})},Tn=function(t,e){return B({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},Rn=B({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["id"],listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),e.element.setAttribute("type",n.type||"button"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(t){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),xn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;return'<svg width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">').concat(t,"</svg>")},In=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return B({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})},An=function(t){t.element.dataset.viewStatus="idle",Cn(t)},Cn=function(t){t.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0,t.markedForRemoval=!0})},Mn=function(t,e,n){t.element.dataset.viewStatus="busy";var r=Sn(t,e,n);Cn(t),t.ref.busyIndicators.push(r),r.markedForRemoval=!1,r.translateY=0,r.opacity=1},Sn=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.appendChildView(t.createChildView(Tn("status-bubble",{styles:["opacity","translateY"],apis:["markedForRemoval"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:n?[{view:Rn,label:"Close",name:"icon-only status-bubble-close",icon:xn('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),action:n},{view:In("p",e)}]:[{view:In("p",e)}]}))},Pn=B({name:"edit-status",ignoreRect:!0,create:function(t){var e=t.root;e.ref.busyIndicators=[],e.element.setAttribute("tabindex",-1)},write:Y({AWAITING_IMAGE:function(t){var e=t.root;e.rect.element.hidden||Mn(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"))},DID_PRESENT_IMAGE:function(t){var e=t.root;An(e)},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root,n=/fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"));Mn(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"),n?function(){e.dispatch("EDIT_CANCEL")}:null)},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;Mn(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"))},DID_REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;Mn(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"))},DID_PREPARE_OUTPUT:function(t){var e=t.root;An(e)}}),didWriteView:function(t){var e=t.root;e.ref.busyIndicators=e.ref.busyIndicators.filter(function(t){return!t.markedForRemoval||0!==t.opacity||(e.removeChildView(t),!1)})}}),Ln={down:"pointerdown",move:"pointermove",up:"pointerup"},Gn=function(){var t=[],e=function(e){return t.findIndex(function(t){return t.pointerId===e.pointerId})};return{update:function(n){var r=e(n);r<0||(t[r]=n)},multiple:function(){return t.length>1},count:function(){return t.length},active:function(){return t.concat()},push:function(n){(function(t){return e(t)>=0})(n)||t.push(n)},pop:function(n){var r=e(n);r<0||t.splice(r,1)}}},Dn=function(t,e,n,r){return t.addEventListener(Ln[e],n,r)},Vn=function(t,e,n){return t.removeEventListener(Ln[e],n)},Un=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},o={x:0,y:0},a={enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:Gn()},c=function(t){return{x:t.pageX-o.x,y:t.pageY-o.y}},u=function(t,e){return e&&e.apply(null,[t,c(t)])},l=function(n){var r=0===a.pointers.count();r&&(a.active=!1,a.cancel=!1,a.cancelled=!1),a.pointers.push(n),Dn(document.documentElement,"up",f),r?(t===n.target||t.contains(n.target))&&n.isPrimary&&(n.preventDefault(),i.stopPropagation&&(n.stopPropagation(),n.stopImmediatePropagation()),a.active=!0,o.x=n.pageX,o.y=n.pageY,Dn(document.documentElement,"move",s),e(n)):i.cancelOnMultiple&&(a.cancel=!0)},s=function(t){t.isPrimary&&(a.cancelled||(t.preventDefault(),u(t,n),a.cancel&&(a.cancelled=!0,u(t,r))))},f=function t(e){a.pointers.pop(e),0===a.pointers.count()&&(Vn(document.documentElement,"move",s),Vn(document.documentElement,"up",t)),a.active&&(a.cancelled||(e.preventDefault(),i.stopPropagation&&e.stopPropagation(),u(e,n),u(e,r)))};return Dn(document.documentElement,"down",l),{enable:function(){a.enabled||Dn(document.documentElement,"down",l),a.enabled=!0},disable:function(){a.enabled&&Vn(document.documentElement,"down",l),a.enabled=!1},destroy:function(){Vn(document.documentElement,"up",f),Vn(document.documentElement,"move",s),Vn(document.documentElement,"down",l)}}},Nn={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},kn=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4?arguments[4]:void 0;e=Math.round(e),n=Math.round(n);var o=i||document.createElement("canvas"),a=o.getContext("2d");return r>=5&&r<=8?(o.width=n,o.height=e):(o.width=e,o.height=n),a.save(),function(t,e,n,r){-1!==r&&t.transform.apply(t,Nn[r](e,n))}(a,e,n,r),a.drawImage(t,0,0,e,n),a.restore(),o},jn=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},zn=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n),i=[];return{transfer:function(t,e){},post:function(t,e,n){var o=st();i[o]=e,r.onmessage=function(t){var e=i[t.data.id];e&&(e(t.data.message),delete i[t.data.id])},r.postMessage({id:o,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Bn=function(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(function(t,n){return t===e[n]})},Yn=function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(new Uint8ClampedArray(t.data)),e};function Fn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var qn=null,Wn=null,Xn=0,Zn=null,Hn=B({name:"image-bitmap",ignoreRect:!0,ignoreRectUpdate:!0,tag:"canvas",mixins:{apis:["zIndex","hasColorMatrix","setColorMatrix"],styles:["opacity","zIndex"],animations:{opacity:"spring"}},create:function(t){var e=t.root,n=t.props;e.ref.activeColorMatrix=null,e.ref.appliedColorMatrix=!1;var r=e.element;r.width=n.imageData.width,r.height=n.imageData.height;var i=r.getContext("2d"),o=function(t){i.putImageData(t,0,0),e.dispatch("DID_APPLY_COLOR_MATRIX",{matrix:e.ref.activeColorMatrix})},a=function(t){var n=e.ref.activeColorMatrix,r=$e(t),i=$e(n);return!r&&!i||Bn(n,t)},c=function(t){return new Promise(function(r){if(e.ref.appliedColorMatrix&&a(t))e.dispatch("DID_APPLY_COLOR_MATRIX",{matrix:e.ref.activeColorMatrix});else{e.ref.appliedColorMatrix=!0,e.ref.activeColorMatrix=$e(t)?Fn(t):null;var i=Yn(n.imageData);if(!$e(t))return o(i),void r(e);(function t(e,n){return new Promise(function(r){if(Date.now()-Xn<150)return clearTimeout(Zn),void(Zn=setTimeout(function(){t(e,n).then(r)},150));Xn=Date.now(),qn||(qn=zn(Be)),clearTimeout(Wn),qn.post({transforms:[{type:"filter",data:n}],imageData:e},function(t){clearTimeout(Wn),Wn=setTimeout(function(){qn.terminate(),qn=null},5e3),r(t)},[e.data.buffer])})})(i,t).then(o).then(function(){return r(e)})}})};n.hasColorMatrix=a,n.setColorMatrix=c,c(n.colorMatrix).then(n.onready||function(){})},write:function(t){var e=t.root,n=t.props;e.element.dataset.dokaLayerIndex=n.zIndex||0}});function Kn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Qn=B({name:"image-preview",ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",mixins:{apis:["colorMatrix"],styles:["perspective","rotateX","rotateY","rotateZ","scaleX","scaleY"],animations:{rotateX:{type:"spring",stiffness:.25,damping:.25,mass:2.5},rotateY:{type:"spring",stiffness:.25,damping:.25,mass:2.5},scaleX:{type:"spring",stiffness:.25,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.25,damping:.75,mass:15}}},write:Y({DID_PRESENT_IMAGE:function(t){var e=t.root;e.scaleX=1,e.scaleY=1},DID_SET_COLOR_MATRIX:function(t){var e=t.root,n=e.ref.bitmaps,r=e.query("GET_COLOR_MATRIX");if((e.ref.currentMatrix||r)&&!Bn(e.ref.currentMatrix,r)){if(e.ref.currentMatrix=Kn(r),2===n.length){var i=n.find(function(t){return 0===t.zIndex});return n.find(function(t){return 1===t.zIndex&&t.opacity>.9})&&(i.opacity=null,i.opacity=0),void i.setColorMatrix(r)}var o=e.createChildView(Hn,{imageData:e.query("GET_PREVIEW_IMAGE_DATA"),colorMatrix:r});o.element.dataset.key="b",o.zIndex=0,o.opacity=null,o.opacity=0,n.push(e.appendChildView(o))}},DID_APPLY_COLOR_MATRIX:function(t){var e=t.root,n=t.action,r=e.ref.bitmaps,i=r.find(function(t){return t.hasColorMatrix(n.matrix)});i&&(r.forEach(function(t){return t.zIndex=0}),i.opacity=1,i.zIndex=1)}}),create:function(t){var e=t.root;e.ref.currentMatrix=null,e.rotateZ=1e-5;var n="preview"!==e.query("GET_STYLE_LAYOUT_MODE");e.scaleX=n?1.15:1,e.scaleY=n?1.15:1,e.rotateX=n?1:null,e.rotateY=n?1:null;var r=e.query("GET_FILE"),i=URL.createObjectURL(r.data);!function(){var t=function(t){var n=Ne(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")}),i=kn(t,n.width,n.height,r.orientation),o=i.height/i.width,a=96*Math.max(1,.75*window.devicePixelRatio),c=kn(i,o>1?a:a/o,o>1?a*o:a),u=i.getContext("2d").getImageData(0,0,i.width,i.height),l=c.getContext("2d").getImageData(0,0,c.width,c.height);e.ref.bitmaps=[e.appendChildView(e.createChildView(Hn,{imageData:u,colorMatrix:e.query("GET_COLOR_MATRIX"),onready:function(){e.dispatch("DID_RECEIVE_IMAGE_DATA",{previewData:u,thumbData:l}),e.dispatch("DID_PRESENT_IMAGE")}}))],e.ref.bitmaps[0].element.dataset.key="a"},n=function(){var e;(e=i,new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(t){n(t)},r.src=e})).then(t)};if(function(t){return"createImageBitmap"in window&&function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)}(t)}(r.data)){var o=zn(jn);o.post({file:r.data},function(e){o.terminate(),e?t(e):n()})}else n()}()}}),Jn={type:"spring",stiffness:.4,damping:.65,mass:7},$n=B({name:"image-container",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["flipHorizontal","flipVertical","scale","colorMatrix"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ","opacity"],animations:{opacity:{type:"tween",delay:150,duration:750},scaleX:Jn,scaleY:Jn,translateX:Jn,translateY:Jn,originX:Jn,originY:Jn,rotateZ:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(t){var e=t.root;e.ref.image=e.appendChildView(e.createChildView(Qn,{rotateX:0,rotateY:0,perspective:2e3})),e.ref.dragger=Un(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t,n){e.dispatch("CROP_IMAGE_DRAG",{value:n})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0})},destroy:function(t){t.root.ref.dragger.destroy()},write:Y({SHOW_VIEW:function(t){var e=t.root;"crop"===t.action.id?(e.element.setAttribute("tabindex",0),e.ref.dragger.enable()):(e.element.removeAttribute("tabindex"),e.ref.dragger.disable())}},function(t){var e=t.root,n=t.props,r=e.ref.image,i=n.colorMatrix;r.rotateX=n.flipVertical?Math.PI:0,r.rotateY=n.flipHorizontal?Math.PI:0,r.colorMatrix=i})}),tr=pt()&&1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},er=function(t,e,n,r,i,o){t||(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null);var a=tr(n),c=tr(r),u=tr(n+i)-a,l=tr(r+o)-c;e.translateX=a,e.translateY=c,e.scaleX=.01*u,e.scaleY=.01*l},nr=["top","right","bottom","left"],rr=B({ignoreRect:!0,name:"image-overlay",mixins:{styles:["opacity"],animations:{opacity:"spring"},apis:["rectangle","container","animate"]},create:function(t){var e=t.root;nr.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return B({ignoreRect:!0,ignoreRectUpdate:!0,name:"image-overlay-panel-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:Jn,translateY:Jn,scaleX:Jn,scaleY:Jn}}})}(t)))})},write:function(t){var e=t.root,n=t.props,r=e.ref,i=r.top,o=r.right,a=r.bottom,c=r.left,u=n.rectangle,l=n.container,s=n.animate;if(u){var f=e.rect.element,h=l,d=u.x,p=u.y,m=h.top,g=h.left,y=p+m,v=h.width,E=d+g,w=d+u.width,_=p+u.height,b=h.height-(_+m),O=g+f.width-(d+u.width);er(s,i,-g-2,-m-2,v+4,y+2),er(s,c,-g-2,p-2,E+2,u.height+4),er(s,o,w,p-2,O+2,u.height+4),er(s,a,-g-2,_,v+4,b+2)}}}),ir=["top","right","bottom","left"],or=B({name:"image-outline",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"spring"}},apis:["animate","rectangle","edgeWidth"]},create:function(t){var e=t.root;ir.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return B({ignoreRect:!0,ignoreRectUpdate:!0,name:"image-outline-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:Jn,translateY:Jn,scaleX:Jn,scaleY:Jn}}})}(t)))})},write:function(t){var e=t.root,n=t.props,r=e.ref,i=r.top,o=r.right,a=r.bottom,c=r.left,u=n.animate,l=n.rectangle,s=n.edgeWidth;if(l){var f=l.x,h=l.y,d=l.width,p=l.height,m=2*s;er(u,i,f-s+1,h-s+1,d+m-2,s),er(u,c,f-s+1,h-s+1,s,p+m-2),er(u,o,f+d-1,h-s+1,s,p+m-2),er(u,a,f-s+1,h+p-1,d+m-2,s)}}});function ar(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var cr=B({name:"image",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["offsetTop"]},create:function(t){var e=t.root;e.ref.hasTroubleAnimatingTransformOrigin="safari"in window,e.ref.image=e.appendChildView(e.createChildView($n,{flip:{horizontal:!1,vertical:!1},translateX:null,translateY:null,rotateZ:null,scaleX:null,scaleY:null,opacity:0})),e.ref.overlay=e.appendChildView(e.createChildView(rr,{opacity:0})),e.ref.outline=e.appendChildView(e.createChildView(or,{opacity:0}))},write:Y({DID_PRESENT_IMAGE:function(t){t.root.ref.image.opacity=1}},function(t){var e=t.root,n=t.props,r=t.actions,i=t.timestamp,o=e.ref,a=o.image,c=o.outline,u=o.overlay,l=o.hasTroubleAnimatingTransformOrigin,s=e.query("GET_CROP",n.id,i);if(s){var f=s.isDraft,h=s.cropRect,d=s.cropStatus,p=s.origin,m=s.translation,g=s.translationBand,y=s.scale,v=s.scaleBand,E=s.rotation,w=s.rotationBand,_=s.flip,b=s.colorMatrix,O=e.query("GET_ROOT"),T=e.query("GET_STAGE"),R=T.x,x=T.y;if(f&&(a.originX=null,a.originY=null,a.translateX=null,a.translateY=null,a.scaleX=null,a.scaleY=null,a.rotateZ=null),a.colorMatrix=b,a.perspective=100,l)!!r.find(function(t){return"CROP_IMAGE_DRAG_RELEASE"===t.type})&&y>1&&(a.originX=null,a.originY=null,a.translateX=null,a.translateY=null);var I=e.query("IS_ACTIVE_VIEW","crop"),A=I?.75:.9,C=1,M=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ar(t,e,n[e])})}return t}({},h),S=1,P=I?1:5;if(e.query("IS_ACTIVE_VIEW","resize")){C=1;var L=d.image.width,G=d.image.height;S=null===L&&null===G?d.crop.width/h.width:null===L?G/h.height:L/h.width,S/=window.devicePixelRatio;var D=h.width*S,V=h.height*S;M.x=M.x+(.5*h.width-.5*D),M.y=M.y+(.5*h.height-.5*V),M.width=D,M.height=V}a.originX=p.x,a.originY=p.y,a.translateX=m.x+g.x+R,a.translateY=m.y+g.y+x,a.scaleX=(y+v)*S,a.scaleY=(y+v)*S,a.rotateZ=E.main+E.sub+w,a.flipHorizontal=_.horizontal,a.flipVertical=_.vertical,u.animate=!f,u.opacity=A,u.container={left:O.left,top:O.top+n.offsetTop,width:O.width,height:O.height},u.rectangle={x:M.x+R,y:M.y+x,width:M.width,height:M.height},c.animate=!f,c.opacity=C,c.edgeWidth=P,c.rectangle={x:M.x+R,y:M.y+x,width:M.width,height:M.height}}})}),ur={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},lr=function(t,e,n,r,i){var o=null,a=!0,c={enabled:!0},u=function(t){var i=ur[t.keyCode]||t.keyCode;n[i]&&(t.stopPropagation(),a&&(o=e(i),a=!1),n[i](o),r(o))},l=function(t){var e=ur[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),i(o),a=!0)};return t.addEventListener("keydown",u),t.addEventListener("keyup",l),{enable:function(){c.enabled||(t.addEventListener("keydown",u),t.addEventListener("keyup",l)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)}}},sr=B({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">',r=0;r<=180;r+=2){var i=r*(176/180)-90+2,o=r%10==0?.5:.2;if(n+='<circle fill="currentColor" cx="'.concat(i,'" cy="').concat(0,'" r="').concat(o,'"/>'),r%10==0)n+='<text fill="currentColor" x="'.concat(i+(i<0?-2.25:0===i?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"&deg;</text>")}n+="</svg>",e.element.innerHTML=n}}),fr=B({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity","translateY"],animations:{opacity:{type:"spring",damping:.5,mass:5},translateY:"spring"},apis:["rotation","animate"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(r);var i=null;e.appendChildView(e.createChildView(function(t,e){return B({name:t,ignoreRect:!0,create:e})}("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;i=e.appendChildView(e.createChildView(sr,{translateX:Math.round(312*n.rotation)}))}),n)),e.ref.line=i;var o=document.createElement("div");o.className="doka--crop-rotator-bar",e.appendChild(o);var a=Math.PI/4,c=0;e.ref.dragger=Un(o,function(){c=i.translateX/312,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t,n){var r=n.x/e.rect.element.width*(Math.PI/2),i=_t(c+r,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-i})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")}),e.ref.keyboard=lr(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:function(t){var e=t.root,n=t.props,r=t.timestamp,i=n.animate,o=n.rotation;i||0===o||(e.ref.line.translateX=null);var a=0,c=e.query("GET_CROP",n.id,r);if(c&&c.interaction&&c.interaction.rotation){var u=Ve(c.interaction.rotation).sub-o;a=.025*Math.sign(u)*Math.log10(1+Math.abs(u)/.025)}e.ref.line.translateX=Math.round(312*(-o-a))}}),hr=["nw","ne","se","sw"],dr=["n","e","s","w"],pr=B({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),mr=function(t){return B({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"]},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button");var r,i=t,o=(r=t,dr[(dr.indexOf(r)+2)%dr.length]);n.ref.dragger=Un(n.element,function(){return n.dispatch("CROP_RECT_EDGE_DRAG_GRAB")},function(t,e){return n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:i,anchor:o})},function(){return n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")}),n.ref.keyboard=lr(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(t){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:i,anchor:o})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")})},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})},gr=function(t,e,n){return B({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:Jn,translateY:Jn,scaleX:{type:"spring",delay:n},scaleY:{type:"spring",delay:n},opacity:{type:"spring",delay:e}}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1);var r,i=t,o=(r=t,hr[(hr.indexOf(r)+2)%hr.length]);n.ref.dragger=Un(n.element,function(){n.dispatch("CROP_RECT_CORNER_DRAG_GRAB")},function(t,e){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:e,origin:i,anchor:o})},function(){n.dispatch("CROP_RECT_CORNER_DRAG_RELEASE")})},destroy:function(t){t.root.ref.dragger.destroy()}})},yr=B({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{apis:["rectangle","draft","rotating"]},create:function(t){var e=t.root;e.ref.wasRotating=!1;hr.forEach(function(t,n){var r=10*n,i=250+r+50,o=250+r;e.ref[t]=e.appendChildView(e.createChildView(gr(t,i,o),{opacity:0,scaleX:.5,scaleY:.5}))}),dr.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(mr(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(pr,{opacity:0})));e.ref.animationDir=null},write:function(t){var e=t.root,n=t.props,r=n.rectangle,i=n.draft,o=n.rotating;if(r){var a=e.ref,c=a.n,u=a.e,l=a.s,s=a.w,f=a.nw,h=a.ne,d=a.se,p=a.sw,m=a.lines,g=a.animationDir,y=r.x,v=r.y,E=r.x+r.width,w=r.y+r.height,_=w-v,b=E-y,O=Math.min(b,_);e.element.dataset.indicatorSize=O<80?"none":"default";var T=e.query("IS_ACTIVE_VIEW","crop");if(T&&"in"!==g?(e.ref.animationDir="in",hr.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=1,t.scaleX=1,t.scaleY=1})):T||"out"===g||(e.ref.animationDir="out",hr.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=0,t.scaleX=.5,t.scaleY=.5})),Er(i,f,y,v),Er(i,h,E,v),Er(i,d,E,w),Er(i,p,y,w),vr(i,c,y,v,b/100,1),vr(i,u,E,v,1,_/100),vr(i,l,y,w,b/100,1),vr(i,s,y,v,1,_/100),o){e.ref.wasRotating=!0;var R=m.slice(0,5),x=1/R.length;R.forEach(function(t,e){vr(i,t,y,v+_*(x+e*x),b/100,.01),t.opacity=.5});var I=m.slice(5);x=1/I.length,I.forEach(function(t,e){vr(i,t,y+b*(x+e*x),v,.01,_/100),t.opacity=.5})}else if(i){e.ref.wasRotating=!1;var A=m[0],C=m[1],M=m[2],S=m[3];vr(i,A,y,v+.333*_,b/100,.01),vr(i,C,y,v+.666*_,b/100,.01),vr(i,M,y+.333*b,v,.01,_/100),vr(i,S,y+.666*b,v,.01,_/100),A.opacity=.5,C.opacity=.5,M.opacity=.5,S.opacity=.5}else{var P=m[0],L=m[1],G=m[2],D=m[3];!e.ref.wasRotating&&P.opacity>0&&(vr(i,P,y,v+.333*_,b/100,.01),vr(i,L,y,v+.666*_,b/100,.01),vr(i,G,y+.333*b,v,.01,_/100),vr(i,D,y+.666*b,v,.01,_/100)),m.forEach(function(t){return t.opacity=0})}}}}),vr=function(t,e,n,r,i,o){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=tr(n),e.translateY=tr(r),e.scaleX=i,e.scaleY=o},Er=function(t,e,n,r){t&&(e.translateX=null,e.translateY=null),e.translateX=tr(n),e.translateY=tr(r)},wr=function(t,e){if(!/svg/.test(t.namespaceURI)||"innerHTML"in t)t.innerHTML=e;else{var n=document.createElement("div");n.innerHTML="<svg>"+e+"</svg>";for(var r=n.firstChild;r.firstChild;)t.appendChild(r.firstChild)}},_r=B({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{scale:Jn,maskWidth:Jn,maskHeight:Jn,translateX:Jn,translateY:Jn,opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(t){var e=t.root;e.customWriter=e.query("GET_CROP_MASK")(e.element,wr)||function(){}},didWriteView:function(t){var e=t.root,n=t.props,r=n.maskWidth,i=n.maskHeight,o=n.scale;if(r&&i){e.element.setAttribute("width",tr(r)),e.element.setAttribute("height",tr(i));var a=e.query("GET_CROP_MASK_INSET");e.customWriter({x:o*a,y:o*a,width:r-o*a*2,height:i-o*a*2},{width:r,height:i})}}}),br=function(t,e){var n=t.childNodes[0];n?e!==n.nodeValue&&(n.nodeValue=e):(n=document.createTextNode(e),t.appendChild(n))},Or=B({ignoreRect:!0,name:"crop-size",mixins:{styles:["translateX","translateY","opacity"],animations:{translateX:"spring",translateY:"spring",opacity:"spring"},listeners:!0},create:function(t){var e=t.root,n=m("span");n.className="doka--crop-size-info doka--crop-resize-percentage",e.ref.resizePercentage=n,e.appendChild(n);var r=m("span");r.className="doka--crop-size-info";var i=m("span");i.className="doka--crop-size-multiply",i.textContent="×";var o=m("span"),a=m("span");e.ref.outputWidth=o,e.ref.outputHeight=a,r.appendChild(o),r.appendChild(i),r.appendChild(a),e.appendChild(r),e.ref.previousValues={width:0,height:0,percentage:0}},write:function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=e.ref,c=a.outputWidth,u=a.outputHeight,l=a.resizePercentage,s=a.previousValues,f=o.image,h=o.crop,d=h.width,p=h.height,m=h.widthFloat/h.heightFloat;f.width&&f.height?(d=f.width,p=f.height):f.width&&!f.height?(d=f.width,p=f.width/m):f.height&&!f.width&&(p=f.height,d=f.height*m),d=Math.round(d),p=Math.round(p);var g=f.width?Math.round(f.width/h.width*100):0;d!==s.width&&(br(c,d),s.width=d),p!==s.height&&(br(u,p),s.height=p),g!==s.percentage&&(f.width?br(l,"".concat(g,"%")):br(l,""),s.percentage=g)}}}),Tr=function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r),o=e.ref.btnZoom;if(o){var a=i.cropRect;o.translateX=a.x+.5*a.width,o.translateY=a.y+.5*a.height}},Rr={type:"spring",stiffness:.4,damping:.65,mass:7},xr=B({name:"crop-subject",ignoreRect:!0,mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250},translateX:Rr,translateY:Rr}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.query("GET_CROP_MASK")&&(e.ref.maskView=e.appendChildView(e.createChildView(_r))),e.ref.cropView=e.appendChildView(e.createChildView(yr)),e.query("GET_CROP_SHOW_SIZE")&&(e.ref.cropSize=e.appendChildView(e.createChildView(Or,{id:n.id,opacity:1,scaleX:1,scaleY:1,translateX:null}))),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(Tn("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:Rn,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:xn('<g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g>',26),action:function(){return e.dispatch("CROP_ZOOM")}}]})))},write:Y({CROP_RECT_EDGE_DRAG_RELEASE:Tr,CROP_RECT_CORNER_DRAG_RELEASE:Tr},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=e.ref,a=o.cropView,c=o.maskView,u=o.btnZoom,l=o.cropSize,s=i.cropRect,f=i.isRotating,h=i.isDraft,d=i.scale;if(e.query("IS_ACTIVE_VIEW","crop")){var p=e.query("GET_STAGE");if(e.translateX=p.x-e.rect.element.left,e.translateY=p.y-e.rect.element.top,a.draft=h,a.rotating=f,a.rectangle=s,l){h&&(l.translateX=null,l.translateY=null);var m=Ir(e.rect.element,l.rect.element,s);l.translateX=h?m.x:tr(m.x),l.translateY=h?m.y:tr(m.y)}c&&(h&&(c.translateX=null,c.translateY=null,c.maskWidth=null,c.maskHeight=null),c.translateX=tr(s.x),c.translateY=tr(s.y),c.maskWidth=s.width,c.maskHeight=s.height,c.scale=d),u&&(u.opacity=i.canRecenter&&!i.isDraft?1:0)}}})}),Ir=function(t,e,n){var r=n.x,i=n.x+n.width,o=n.y+n.height,a=i-e.width-16,c=o-e.height-16;return e.width>n.width-32&&(a=r+(.5*n.width-.5*e.width),(c=o+16)>t.height-e.height&&(c=o-e.height-16)),{x:a=Math.max(0,Math.min(a,t.width-e.width)),y:c}},Ar=function(){return performance.now()};function Cr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Mr(t,e,n[e])})}return t}function Mr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Sr=function(t,e){var n=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null}(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},Pr=function(t){var e=t.root,n=t.props,r=t.action.position,i=n.pivotPoint,o=e.ref,a=o.indicatorA,c=o.indicatorB,u=i.x-r.x,l=i.y-r.y,s={x:i.x+u,y:i.y+l},f={x:i.x-u,y:i.y-l};a.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)")},Lr=function(t){return{x:t.pageX,y:t.pageY}},Gr=B({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint"]},create:function(t){var e=t.root,n=t.props;e.ref.isActive=!1,e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var r=e.query("GET_CROP_RESIZE_KEY_CODES"),i={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},o=Ar();e.ref.state=i;var a=Gn(),c=0,u=!1;e.ref.resizeStart=function(t){if(e.ref.isActive&&(0===a.count()&&(u=!1),a.push(t),Dn(document.documentElement,"up",e.ref.resizeEnd),Sr(e.element,t.target)&&a.multiple())){t.stopPropagation(),t.preventDefault();var n=a.active(),r=Lr(n[0]),i=Lr(n[1]);c=Rt(r,i),Dn(document.documentElement,"move",e.ref.resizeMove),u=!0}},e.ref.resizeMove=function(t){if(e.ref.isActive&&u&&(t.preventDefault(),2===a.count())){a.update(t);var n=a.active(),r=Lr(n[0]),i=Lr(n[1]),o=(Rt(r,i)-c)/c;e.dispatch("CROP_IMAGE_RESIZE",{value:o})}},e.ref.resizeEnd=function(t){if(e.ref.isActive){a.pop(t);var n=0===a.count();n&&(Vn(document.documentElement,"move",e.ref.resizeMove),Vn(document.documentElement,"up",e.ref.resizeEnd)),u&&(t.preventDefault(),n&&e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))}},Dn(document.documentElement,"down",e.ref.resizeStart);var l=performance.now(),s=0,f=1,h=function(t,e){var n=null,r=null;return function(){var i=arguments;if(!r)return t.apply(null,Array.from(arguments)),void(r=Ar());clearTimeout(n),n=setTimeout(function(){Ar()-r>=e&&(t.apply(null,Array.from(i)),r=Ar())},e-(Ar()-r))}}(function(t){var n=Math.sign(t.wheelDelta||t.deltaY),r=Ar(),i=r-l;l=r,(i>750||s!==n)&&(f=1,s=n),f+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,f)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},100);e.ref.wheel=function(t){e.ref.isActive&&/doka--/.test(t.target.className)&&Sr(e.element,t.target)&&(t.preventDefault(),h(t))},document.addEventListener("wheel",e.ref.wheel,{passive:!1}),e.ref.move=function(t){if(e.ref.isActive&&(i.position.x=t.pageX-e.ref.state.offsetX,i.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,i.enabled))if(Sr(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:Cr({},i.position)}),t.preventDefault(),e.dispatch("RESIZER_MOVE",{position:Cr({},i.position)});var r=n.pivotPoint,a=r.x-i.position.x,u=r.y-i.position.y,l={x:r.x+a,y:r.y+u},s=Cr({},i.position);if(i.selecting){var f=(Rt(l,s)-c)/c,h=performance.now();h-o>25&&(o=h,e.dispatch("CROP_IMAGE_RESIZE",{value:f}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(e.ref.isActive&&Sr(e.element,t.target)){var r=n.pivotPoint,o=r.x-i.position.x,a=r.y-i.position.y,u={x:r.x+o,y:r.y+a},l=i.position;c=Rt(u,l),i.selecting=!0,i.origin.x=t.pageX,i.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){e.ref.isActive&&Sr(e.element,t.target)&&(i.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(t){e.ref.isActive&&(i.selecting=!1,i.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){e.ref.isActive&&r.includes(t.keyCode)&&i.position&&(i.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:Cr({},i.position)}))},e.ref.keyUp=function(t){e.ref.isActive&&r.includes(t.keyCode)&&(i.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.resizeMove),document.removeEventListener("touchend",e.ref.resizeEnd),document.removeEventListener("touchstart",e.ref.resizeStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.action;e.ref.isActive="crop"===n.id},RESIZER_SHOW:function(t){var e=t.root,n=t.props,r=t.action;e.element.dataset.state="multi-touch",Pr({root:e,props:n,action:r})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:Pr})});function Dr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Vr(t,e,n[e])})}return t}function Vr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ur(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Nr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"group",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["opacity"],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return B({ignoreRect:!0,name:t,mixins:{styles:["opacity"].concat(Ur(e)),animations:Dr({opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}},n)},create:function(t){var e=t.root;t.props.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})};function kr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){jr(t,e,n[e])})}return t}function jr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var zr=B({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue","options"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick),e.ref.activeOptions=null},write:function(t){var e=t.root,n=t.props;n.options!==e.ref.activeOptions&&(e.ref.activeSelectedValue=null,e.ref.activeOptions=n.options,e.childViews.forEach(function(t){return e.removeChildView(t)}),n.options.map(function(t){var r=e.createChildView(Rn,kr({},t,{action:function(){return e.dispatch(n.optionAction,{value:t.value})}}));return e.appendChildView(r)}));var r=n.options.findIndex(function(t){return t.value===n.selectedValue});e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===r)})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),Br=B({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{apis:["selectedValue","options"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var r=function(t){e.ref.open=t,e.dispatch(n.buttonAction)};e.ref.button=e.appendChildView(e.createChildView(Rn,kr({},n,{action:function(){r(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(zr,kr({},n,{action:function(){r(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||r(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&r(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||r(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;e.ref.list.opacity=e.ref.open?1:0,e.ref.list.translateY=e.ref.open?0:-5,e.ref.list.selectedValue=n.selectedValue,e.ref.list.options=n.options}});function Yr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Fr(t,e,n[e])})}return t}function Fr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qr=function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var r=Math.round(.5*(23-e)),i=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="'.concat(r,'" y="').concat(i,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')},Wr=B({name:"crop",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="crop",n.hidden=!1,e.ref.isHiding=!1;var r=[{view:Rn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:xn('<g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}},{view:Rn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:xn('<g fill="currentColor" fill-rule="evenodd"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}},{view:Rn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:xn('<g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g></svg>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}}],i=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");i&&r.push({view:Br,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:xn('<g class="doka--icon-aspect-ratio" fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g>',26),buttonAction:"TOGGLE_ASPECT_RATIO",optionAction:"CROP_SET_ASPECT_RATIO",options:null,didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.splice(1,0,{view:Rn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:xn('<g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.ref.menu=e.appendChildView(e.createChildView(Nr("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:r})),e.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(xr,Yr({},n))),e.ref.rotator=e.appendChildView(e.createChildView(fr,{rotation:0,opacity:0,translateY:20,id:n.id})),e.ref.resizer=e.appendChildView(e.createChildView(Gr,{pivotPoint:{x:0,y:0}})),e.ref.updateControls=function(){var t=e.query("GET_IMAGE");if(function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})}(e,t.height/t.width),e.ref.aspectRatioDropdown){var n=e.query("GET_MIN_IMAGE_SIZE"),r=i.filter(function(e){if(!e.value)return!0;if(e.value<1){if(t.naturalWidth*e.value<n.height)return!1}else if(t.naturalHeight/e.value<n.width)return!1;return!0});e.ref.aspectRatioDropdown.options=r.map(function(t){return Yr({},t,{icon:qr(t.value)})})}};var o=0,a=0;e.ref.keyboard=lr(e.element,function(){return o=0,a=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){o+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:o}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){o-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:o}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){a-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},right_bracket:function(){a+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},read:function(t){var e=t.root,n=t.props;if(null===e.menuItemsRequiredWidth){var r=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.menuItemsRequiredWidth=0===r?null:r}var i=e.ref.subject.rect.element,o=i.left,a=i.top,c=i.width,u=i.height;n.stagePosition={x:o,y:a,width:c,height:u}},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props,i=e.ref,o=i.menu,a=i.rotator,c=i.subject;r.viewId===n.id?(c.opacity=1,o.opacity=1,a.opacity=1,a.translateY=0,r.hidden=!1,e.ref.isHiding=!1,e.ref.updateControls()):(c.opacity=0,o.opacity=0,a.opacity=0,a.translateY=20,e.ref.isHiding=!0)},UNLOAD_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0,r.translateY=20},DID_PRESENT_IMAGE:function(t){var e=t.root,n=e.ref,r=n.menu,i=n.rotator;r.opacity=1,i.opacity=1,i.translateY=0,e.ref.updateControls()}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.ref,o=i.resizer,a=i.subject,c=i.menu,u=i.rotator,l=i.isHiding,s=i.aspectRatioDropdown,f=n.hidden,h=0===a.opacity&&0===c.opacity&&0===u.opacity;if(!f&&l&&h&&(n.hidden=!0),!n.hidden){var d=e.query("GET_CROP",n.id,r);if(d){if(s){var p=e.query("GET_ACTIVE_CROP_ASPECT_RATIO");s.selectedValue!==p&&(!function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return n[0].style.opacity=.2,n[1].style.opacity=.3,void(n[2].style.opacity=.4);n[0].style.opacity=e>1?1:.3,n[1].style.opacity=1===e?.85:.5,n[2].style.opacity=e<1?1:.3}}(e,p),s&&(s.selectedValue=p))}o.pivotPoint={x:.5*o.rect.element.width,y:.5*o.rect.element.height},u.animate=!d.isDraft,u.rotation=d.rotation.sub,c.element.dataset.layout=e.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}}})}),Xr=B({name:"size-input",mixins:{listeners:!0,apis:["id","value","placeholder","getValue","setValue","setPlaceholder","hasFocus","onChange"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.min,o=n.max,a=n.value,c=n.placeholder,u=n.onChange,l=void 0===u?function(){}:u,s=n.onBlur,f=void 0===s?function(){}:s,h="doka--".concat(r),d=m("input",{type:"number",step:1,id:h,min:i,max:o,value:a,placeholder:c}),p=d.getAttribute("max").length,g=m("label",{for:h});g.textContent=n.label;var y=function(t,e,n){return H(t)?((t=t.replace(/[^0-9]/g,"")).length>p&&(t=t.slice(0,p)),t=parseInt(t,10)):t=Math.round(t),isNaN(t)?null:_t(t,e,n)},v=function(t){return t.length?parseInt(d.value,10):null};e.ref.handleInput=function(){d.value=y(d.value,1,o),l(v(d.value))},e.ref.handleBlur=function(){d.value=y(d.value,i,o),f(v(d.value))},d.addEventListener("input",e.ref.handleInput),d.addEventListener("blur",e.ref.handleBlur),e.appendChild(d),e.appendChild(g),e.ref.input=d,n.hasFocus=function(){return d===document.activeElement},n.getValue=function(){return v(d.value)},n.setValue=function(t){return d.value=t?y(t,1,999999):null},n.setPlaceholder=function(t){return d.placeholder=t}},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("input",e.ref.handleInput),e.ref.input.removeEventListener("blur",e.ref.handleBlur)}}),Zr=B({name:"checkable",tag:"span",mixins:{listeners:!0,apis:["id","checked","onChange","onSetValue","setValue","getValue"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.checked,o=n.onChange,a=void 0===o?function(){}:o,c=n.onSetValue,u=void 0===c?function(){}:c,l=m("input",{type:"checkbox",value:1,id:r});l.checked=i,e.ref.input=l;var s=m("label",{for:r});s.innerHTML=n.label,e.appendChild(l),e.appendChild(s),e.ref.handleChange=function(){u(l.checked),a(l.checked)},l.addEventListener("change",e.ref.handleChange),n.getValue=function(){return l.checked},n.setValue=function(t){l.checked=t,u(l.checked)},setTimeout(function(){u(l.checked)},0)},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("change",e.ref.handleChange)}}),Hr=null,Kr=B({ignoreRect:!0,name:"resize-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15,delay:150}}},create:function(t){var e=t.root;e.element.setAttribute("novalidate","novalidate"),e.element.setAttribute("action","#"),e.ref.shouldBlurKeyboard=gt()||(null===Hr&&(Hr=/Android/i.test(navigator.userAgent)),Hr);var n=e.query("GET_SIZE_MAX"),r=e.query("GET_SIZE_MIN"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.axisLock,o=void 0===i?"none":i,a=t.enforceLimits,c=void 0!==a&&a,u=e.ref,l=u.inputImageWidth,s=u.inputImageHeight,f=u.buttonConfirm,h=e.query("GET_SIZE_ASPECT_RATIO_LOCK"),d=e.query("GET_CROP_RECTANGLE_ASPECT_RATIO"),p={width:l.getValue(),height:s.getValue()},m=te(p,c?r:{width:1,height:1},c?n:{width:999999,height:999999},h?d:null,o);if(h)"width"===o?s.setValue(m.width/d):"height"===o?l.setValue(m.height*d):(l.setValue(m.width||m.height*d),s.setValue(m.height||m.width/d));else if(m.width&&!m.height){var g=Math.round(m.width/d),y=te({width:m.width,height:g},c?r:{width:1,height:1},c?n:{width:999999,height:999999},d,o);c&&l.setValue(Math.round(y.width)),s.setPlaceholder(Math.round(y.height))}else if(m.height&&!m.width){var v=Math.round(m.height*d);l.setPlaceholder(v)}var E=e.query("GET_SIZE_INPUT"),w=E.width,_=E.height,b=O(w)?Math.round(w):null,T=O(_)?Math.round(_):null,R=l.getValue(),x=s.getValue(),I=R!==b||x!==T;return f.opacity=I?1:0,e.dispatch("KICK"),{width:l.getValue(),height:s.getValue()}},o=e;e.appendChildView(e.createChildView(Qr("Image size",function(t){var e=t.root,a=e.query("GET_SIZE"),c=e.appendChildView(e.createChildView(Xr,{id:"image-width",label:"Width",value:O(a.width)?Math.round(a.width):null,min:r.width,max:n.width,placeholder:0,onChange:function(){return i({axisLock:"width"})},onBlur:function(){return i({enforceLimits:!1})}})),u=e.appendChildView(e.createChildView(Zr,{id:"aspect-ratio-lock",label:xn('<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="doka--aspect-ratio-lock-ring" d="M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V14"/><rect fill="currentColor" x="7" y="10" width="10" height="7" rx="1.5"/></g>'),checked:e.query("GET_SIZE_ASPECT_RATIO_LOCK"),onSetValue:function(t){var e=t?0:-3;u.element.querySelector(".doka--aspect-ratio-lock-ring").setAttribute("transform","translate(0 ".concat(e,")"))},onChange:function(t){e.dispatch("RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK",{value:t}),i()}})),l=e.appendChildView(e.createChildView(Xr,{id:"image-height",label:"Height",value:O(a.height)?Math.round(a.height):null,min:r.height,max:n.height,placeholder:0,onChange:function(){return i({axisLock:"height"})},onBlur:function(){return i({enforceLimits:!1})}}));o.ref.aspectRatioLock=u,o.ref.inputImageWidth=c,o.ref.inputImageHeight=l}))),e.ref.buttonConfirm=e.appendChildView(e.createChildView(Rn,{name:"app action-confirm icon-only",label:"Apply",action:function(){},opacity:0,icon:xn('><polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),type:"submit"})),e.ref.confirmForm=function(t){var n=i({enforceLimits:!0});t.preventDefault();var r=e.ref,o=r.shouldBlurKeyboard,a=r.buttonConfirm;o&&(document.activeElement.blur(),a.element.focus()),a.opacity=0,e.dispatch("RESIZE_SET_OUTPUT_SIZE",n)},e.element.addEventListener("submit",e.ref.confirmForm)},destroy:function(t){var e=t.root;e.element.removeEventListener("submit",e.ref.confirmForm)},write:Y({EDIT_RESET:function(t){var e=t.root,n=e.query("GET_SIZE"),r=e.ref,i=r.inputImageWidth,o=r.inputImageHeight,a=r.aspectRatioLock,c=r.buttonConfirm;i.setValue(n.width),o.setValue(n.height),a.setValue(e.query("GET_SIZE_ASPECT_RATIO_LOCK")),c.opacity=0},RESIZE_SET_OUTPUT_SIZE:function(t){var e=t.root,n=t.action,r=e.ref,i=r.inputImageWidth,o=r.inputImageHeight;i.setValue(n.width),o.setValue(n.height)},CROP_SET_ASPECT_RATIO:function(t){var e=t.root,n=t.props,r=t.action,i=t.timestamp,o=e.query("GET_CROP",n.id,i);if(o){var a=o.cropStatus,c=e.ref,u=c.inputImageWidth,l=c.inputImageHeight;null!==r.value?(u.setValue(a.image.width),u.setPlaceholder(a.crop.width),l.setValue(a.image.height),l.setPlaceholder(a.crop.height)):u.getValue()&&l.getValue()&&(l.setValue(null),l.setPlaceholder(a.crop.height))}}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=e.ref,c=a.inputImageWidth,u=a.inputImageHeight;if(!c.hasFocus()&&!u.hasFocus()){var l=e.query("GET_CROP_RECTANGLE_ASPECT_RATIO");if(null===c.getValue()&&null===u.getValue())c.setPlaceholder(o.crop.width),u.setPlaceholder(o.crop.height);else if(null===c.getValue()&&null!==o.image.height){var s=Math.round(o.image.height*l);c.setPlaceholder(s)}else if(null===u.getValue()&&null!==o.image.width){var f=Math.round(o.image.width/l);u.setPlaceholder(f)}}}})}),Qr=function(t,e){return B({tag:"fieldset",create:function(n){var r=n.root,i=m("legend");i.textContent=t,r.element.appendChild(i),e({root:r})}})},Jr=B({name:"resize",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="resize",n.hidden=!1,e.ref.isHiding=!1,e.ref.form=e.appendChildView(e.createChildView(Kr,{opacity:0,id:n.id}))},read:function(t){var e=t.root,n=t.props,r=e.ref.form.rect,i=e.rect;n.stagePosition={x:i.element.left,y:i.element.top+r.element.height,width:i.element.width,height:i.element.height-r.element.height}},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;n.id===r.viewId?(e.ref.isHiding=!1,e.ref.form.opacity=1,e.dispatch("CROP_ZOOM")):(e.ref.isHiding=!0,e.ref.form.opacity=0)}},function(t){var e=t.root,n=t.props,r=e.ref,i=r.form,o=r.isHiding,a=n.hidden;o&&0===i.opacity&&!a&&(n.hidden=!0)})}),$r=B({name:"range-input",tag:"span",mixins:{listeners:!0,apis:["onUpdate","setValue","getValue"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.min,o=n.max,a=n.step,c=n.value,u=n.onUpdate,l=void 0===u?function(){}:u,s=m("input",{type:"range",id:r,min:i,max:o,step:a});s.value=c,e.ref.input=s;var f=m("span");f.className="doka--range-input-inner";var h=m("label",{for:r});h.innerHTML=n.label;var d=i+.5*(o-i);e.element.dataset.centered=c===d,e.ref.handleRecenter=function(){n.setValue(d),e.ref.handleChange()};var p=m("button",{type:"button"});p.textContent="center",p.addEventListener("click",e.ref.handleRecenter),e.ref.recenter=p,f.appendChild(s),f.appendChild(p),e.appendChild(h),e.appendChild(f),e.ref.handleChange=function(){var t=n.getValue();e.element.dataset.centered=t===d,l(t)},s.addEventListener("input",e.ref.handleChange),n.getValue=function(){return parseFloat(s.value)},n.setValue=function(t){return s.value=t};var g=null;e.ref.dragger=Un(f,function(){g=s.getBoundingClientRect()},function(t){var n=(t.pageX-g.left)/g.width;s.value=i+n*(o-i),e.ref.handleChange()})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.recenter.removeEventListener("click",e.ref.handleRecenter),e.ref.input.removeEventListener("input",e.ref.handleChange)}}),ti={brightness:{icon:xn('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="7"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></g>')},contrast:{icon:xn('<g fill="none" fill-rule="evenodd"><circle stroke="currentColor" stroke-width="3" cx="12" cy="12" r="10"/><path d="M12 2v20C6.477 22 2 17.523 2 12S6.477 2 12 2z" fill="currentColor"/></g>')},exposure:{icon:xn('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path d="M20.828 3.172L3.172 20.828A3.987 3.987 0 0 1 2 18V6a4 4 0 0 1 4-4h12c1.105 0 2.105.448 2.828 1.172zM7 7H5v2h2v2h2V9h2V7H9V5H7v2zM12 15h5v2h-5z" fill="currentColor"/></g>')},saturation:{icon:xn('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path fill="currentColor" opacity=".3" d="M7 2.5h5v18.75H7z"/><path fill="currentColor" opacity=".6" d="M12 2.5h5v18.75h-5z"/><path fill="currentColor" opacity=".9" d="M17 2.5h4v18.75h-4z"/></g>')}},ei=B({ignoreRect:!0,name:"color-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15}}},create:function(t){var e=t.root;e.element.setAttribute("novalidate","novalidate");var n=e.query("GET_COLOR_VALUES");e.ref.tools=Object.keys(ti).reduce(function(t,r){var i=r,o=ti[r].icon,a=e.query("GET_LABEL_COLOR_".concat(r.toUpperCase())),c=e.query("GET_COLOR_".concat(r.toUpperCase(),"_RANGE")),u=n[r];return t[i]={view:e.appendChildView(e.createChildView($r,{id:i,label:"".concat(o,"<span>").concat(a,"</span>"),min:c[0],max:c[1],step:.01,value:u,onUpdate:function(t){return e.dispatch("COLOR_SET_COLOR_VALUE",{key:i,value:t})}}))},t},{})},write:Y({COLOR_SET_VALUE:function(t){var e=t.root,n=t.action;e.ref.tools[n.key].view.setValue(n.value)}})}),ni=null,ri=null,ii=function(t,e){var n=e.brightness,r=e.exposure,i=e.contrast,o=e.saturation;if(0!==n){var a=n<0,c=a?"multiply":"overlay",u=a?0:255,l=a?Math.abs(n):1-n;t.ref.imageOverlay.style.cssText="mix-blend-mode: ".concat(c,"; background: rgba(").concat(u,",").concat(u,",").concat(u,",").concat(l,")")}return t.ref.imageOverlay.style.cssText="background:transparent",t.ref.image.style.cssText="filter: brightness(".concat(r,") contrast(").concat(i,") saturate(").concat(o,")"),e},oi=Object.keys(ti),ai=function(t){return B({ignoreRect:!0,tag:"li",name:"filter-tile",mixins:{styles:["opacity","translateY"],animations:{translateY:{type:"spring",delay:10*t},opacity:{type:"spring",delay:30*t}}},create:function(t){var e=t.root,n=t.props,r="filter-".concat(n.style),i=m("input",{id:r,type:"radio",name:"filter"});e.appendChild(i),i.checked=n.selected,i.value=n.style,i.addEventListener("change",function(t){i.checked&&n.onSelect()});var o=m("label",{for:r});o.textContent=n.label,e.appendChild(o);var a=n.imageData,c=Math.min(a.width,a.height),u=c,l=m("canvas");l.width=c,l.height=u;var s=l.getContext("2d");e.ref.image=l;var f=m("div");e.ref.imageOverlay=f;var h={x:.5*c-.5*a.width,y:.5*u-.5*a.height},d=m("div");d.appendChild(l),d.appendChild(f),e.appendChild(d),e.ref.imageWrapper=d,n.matrix?(ni||(ni=zn(Be)),clearTimeout(ri),ni.post({transforms:[{type:"filter",data:n.matrix}],imageData:a},function(t){s.putImageData(t,h.x,h.y),clearTimeout(ri),ri=setTimeout(function(){ni.terminate(),ni=null},1e3)},[a.data.buffer]),e.ref.activeColors=ii(e,e.query("GET_COLOR_VALUES"))):s.putImageData(a,h.x,h.y)},write:function(t){var e,n,r=t.root,i=r.query("GET_COLOR_VALUES"),o=r.ref.activeColors;(o||!i)&&(e=o,n=i,oi.findIndex(function(t){return e[t]!==n[t]})<0)||(r.ref.activeColors=i,ii(r,i))}})};function ci(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ui=B({ignoreRect:!0,tag:"ul",name:"filter-list",mixins:{apis:["visible"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("role","list"),e.ref.tiles=[],e.ref.isHiding=!1;var r=e.query("GET_THUMB_IMAGE_DATA"),i=e.query("GET_FILTERS"),o=[];l(i,function(t,e){o.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ci(t,e,n[e])})}return t}({id:t},e))}),e.ref.activeFilter=e.query("GET_FILTER"),e.ref.tiles=o.map(function(t,i){var o=t.matrix(),a=e.ref.activeFilter===t.id||Bn(e.ref.activeFilter,o)||0===i;return e.appendChildView(e.createChildView(ai(i),{opacity:0,translateY:-5,id:n.id,style:t.id,label:t.label,matrix:o,imageData:Yn(r),selected:a,onSelect:function(){return e.dispatch("FILTER_SET_FILTER",{value:o?t.id:null})}}))})},write:function(t){var e=t.root,n=e.query("GET_FILTER");if(n!==e.ref.activeFilter){e.ref.activeFilter=n;var r=e.query("GET_FILTERS"),i=n?H(n)?n:$e(n)?Object.keys(r).find(function(t){return Bn(r[t].matrix(),n)}):null:"original";Array.from(e.element.querySelectorAll("input")).forEach(function(t){return t.checked=t.value===i})}e.query("IS_ACTIVE_VIEW","filter")?e.ref.tiles.forEach(function(t){t.opacity=1,t.translateY=0}):e.ref.tiles.forEach(function(t){t.opacity=0,t.translateY=-5})}}),li=B({name:"filter",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="filter",n.hidden=!1,e.ref.isHiding=!1,e.ref.filters=e.appendChildView(e.createChildView(ui,{id:n.id}))},read:function(t){var e=t.root,n=t.props;if(e.ref.filters){var r=e.rect,i=e.ref.filters.rect,o=0===i.element.top,a=o?r.element.top+i.element.height:r.element.top,c=o?r.element.height-i.element.height:r.element.height-i.element.height-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:a,width:r.element.width-i.element.left,height:c}}},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;e.ref.filters&&(n.id===r.viewId?(e.ref.isHiding=!1,e.ref.filters.visible=!0):(e.ref.isHiding=!0,e.ref.filters.visible=!1))}})}),si=B({name:"color",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="color",n.hidden=!1,e.ref.isHiding=!1,e.ref.form=e.appendChildView(e.createChildView(ei,{opacity:0,id:n.id}))},read:function(t){var e=t.root,n=t.props,r=e.rect,i=e.ref.form.rect,o=i.element.height,a=0===i.element.top,c=a?r.element.top+o:r.element.top,u=a?r.element.height-o:r.element.height-o-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:c,width:r.element.width-i.element.left,height:u}},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;n.id===r.viewId?(e.ref.isHiding=!1,e.ref.form.opacity=1):(e.ref.isHiding=!0,e.ref.form.opacity=0)}})});function fi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var hi={crop:Wr,resize:Jr,filter:li,color:si},di=B({name:"view-stack",ignoreRect:!0,create:function(t){var e=t.root;e.ref.activeView=null,e.ref.activeStagePosition=null,e.ref.shouldFocus=!1},write:Y({SHOW_VIEW:function(t){var e=t.root,n=t.props,r=t.action,i=e.childViews.find(function(t){return t.viewId===r.id});i||(i=e.appendChildView(e.createChildView(hi[r.id],function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){fi(t,e,n[e])})}return t}({},n)))),e.ref.activeView=i,e.childViews.map(function(t){return t.element}).forEach(function(t){t.dataset.viewActive="false",t.removeAttribute("tabindex")});var o=e.ref.activeView.element;o.dataset.viewActive="true",o.setAttribute("tabindex",-1),e.ref.shouldFocus=!0},DID_PRESENT_IMAGE:function(t){var e=t.root;e.dispatch("CHANGE_VIEW",{id:e.query("GET_UTILS")[0]})},DID_SET_UTILS:function(t){var e=t.root;e.dispatch("CHANGE_VIEW",{id:e.query("GET_UTILS")[0]})}},function(t){var e,n,r=t.root,i=r.ref,o=i.activeView,a=i.previousStagePosition;if(o&&o.stagePosition&&(e=o.stagePosition,n=a,!e||!n||!function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}(e,n))){var c=o.stagePosition,u=c.x,l=c.y,s=c.width,f=c.height;if(0===s&&0===f)return;r.dispatch("DID_RESIZE_STAGE",{offset:{x:u,y:l},size:{width:s,height:f},animate:!0}),r.ref.previousStagePosition=o.stagePosition}}),didWriteView:function(t){var e=t.root;e.ref.shouldFocus&&(e.ref.activeView.element.focus({preventScroll:!0}),e.ref.shouldFocus=!1)}}),pi=B({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.ref.viewStack=e.appendChildView(e.createChildView(di,{id:n.id})),e.ref.image=null},write:Y({DID_PRESENT_IMAGE:function(t){t.root.ref.image.opacity=1},DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.image=e.appendChildView(e.createChildView(cr,{id:n.id}))}},function(t){var e=t.root,n=e.ref.image;n&&(n.offsetTop=e.rect.element.top)})});function mi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){yi(t,e,n[e])})}return t}function yi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vi=B({name:"container",create:function(t){var e,n=t.root,r=[(e={view:Rn,didCreateView:function(t){return n.ref.btnReset=t},opacity:0,label:n.query("GET_LABEL_BUTTON_RESET")},yi(e,"didCreateView",function(t){return n.ref.btnReset=t}),yi(e,"name","app action-reset icon-only"),yi(e,"icon",xn('<g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g>',26)),yi(e,"action",function(){return n.dispatch("EDIT_RESET")}),e)];n.query("GET_ALLOW_BUTTON_CANCEL")&&r.unshift({view:Rn,label:n.query("GET_LABEL_BUTTON_CANCEL"),name:"app action-cancel icon-fallback",opacity:1,icon:xn('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),didCreateView:function(t){n.ref.btnCancel=t},action:function(){n.dispatch("EDIT_CANCEL")}}),n.ref.utilViews=[];var i={crop:{title:n.query("GET_LABEL_BUTTON_UTIL_CROP"),icon:xn('<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="2"><path d="M23 17H9a2 2 0 0 1-2-2v-5m0-3V1"/><path d="M1 7h14a2 2 0 0 1 2 2v7m0 4v3"/></g>')},filter:{title:n.query("GET_LABEL_BUTTON_UTIL_FILTER"),icon:xn('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417"/><path d="M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51"/></g>')},color:{title:n.query("GET_LABEL_BUTTON_UTIL_COLOR"),icon:xn('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4"/></g></g>')},resize:{title:n.query("GET_LABEL_BUTTON_UTIL_RESIZE"),icon:xn('<g fill="none" fill-rule="evenodd" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="12" width="10" height="10" rx="2"/><path d="M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5"/><path d="M14 10l3.365-3.365M14 6h4v4" class="doka--icon-resize-arrow-ne"/><path d="M14 10l3.365-3.365M14 6v4h4" class="doka--icon-resize-arrow-sw"/></g>')}},o=Object.keys(i).map(function(t){return gi({id:t},i[t])});n.ref.utilMenu=null;var a=Nr("utils");r.push({view:a,opacity:1,didCreateView:function(t){n.ref.utilMenu=t},controls:o.map(function(t){return{name:"tab",view:Rn,label:t.title,opacity:1,icon:t.icon,id:t.id,didCreateView:function(e){n.ref.utilViews.push(e),n.ref["util_button_".concat(t.id)]=e},action:function(){return n.dispatch("CHANGE_VIEW",{id:t.id})}}})}),n.query("GET_ALLOW_BUTTON_CONFIRM")&&r.push({view:Rn,label:n.query("GET_LABEL_BUTTON_CONFIRM"),name:"app action-confirm icon-fallback",opacity:1,icon:xn('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),didCreateView:function(t){n.ref.btnConfirm=t},action:function(){n.dispatch("EDIT_CONFIRM")}}),n.ref.menu=n.appendChildView(n.createChildView(Nr("menu"),{controls:r})),n.ref.menu.opacity=0,n.ref.status=n.appendChildView(n.createChildView(Pn)),n.dispatch("AWAIT_IMAGE"),n.ref.handleFocusOut=function(){var t=n.ref.status;"busy"===t.element.dataset.viewStatus&&t.element.focus()},n.ref.handleFocusIn=function(t){var e=n.ref,r=e.menu,i=e.content,o=t.target;if(!r.element.contains(o)&&i&&i.element.contains(o)){if(!Array.from(n.element.querySelectorAll("[data-view-active=false]")).reduce(function(t,e){return e.contains(o)&&(t=!0),t},!1))return;r.element.querySelector("button,input,[tabindex]").focus()}},n.element.addEventListener("focusin",n.ref.handleFocusIn),n.element.addEventListener("focusout",n.ref.handleFocusOut),n.ref.previousState=null},destroy:function(t){var e=t.root;e.element.removeEventListener("focusin",e.ref.handleFocusIn),e.element.removeEventListener("focusout",e.ref.handleFocusOut)},write:Y({DID_SET_UTILS:function(t){var e=t.root,n=mi(e.query("GET_UTILS"));e.ref.utilMenu.element.dataset.utilCount=n.length,1===n.length&&(n.length=0),e.ref.utilViews.forEach(function(t){t.element.dataset.enabled=n.includes(t.id)})},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.ref.utilViews.forEach(function(t){return t.element.dataset.active=t.id===n.id})},UNLOAD_IMAGE:function(t){var e=t.root;e.ref.content&&(e.ref.content.opacity=0,e.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(t){var e=t.root;e.removeChildView(e.ref.content),e.ref.content=null},DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.content=e.appendChildView(e.createChildView(pi,{opacity:null,id:n.id})),e.ref.menu.opacity=1}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=o.image,c=o.crop,u=c.width,l=c.height,s=c.widthFloat/c.heightFloat;a.width&&a.height?(u=a.width,l=a.height):a.width&&!a.height?(u=a.width,l=a.width/s):a.height&&!a.width&&(l=a.height,u=a.height*s);var f={crop:{width:u=Math.round(u),height:l=Math.round(l)}};Ei(e.ref.previousState,f)&&(e.dispatch("DID_UPDATE",{state:gi({},f)}),e.ref.previousState=f);var h,d,p=e.ref,m=p.btnCancel,g=p.content,y=p.util_button_resize,v=i.canReset,E=i.cropStatus;if(e.ref.btnReset.opacity=v?1:0,m&&e.query("GET_UTILS").length>1){var w=e.query("GET_ROOT");m.opacity=v&&w.width<600?0:1}y&&(h=y,d=E.image.width?E.image.width/E.crop.width:null,h.element.dataset.scaleDirection=null===d||d>1?"up":"down"),g&&0===g.opacity&&e.dispatch("DID_UNLOAD_IMAGE")}})}),Ei=function(t,e){return!t||(t.crop.width!==e.crop.width||t.crop.height!==e.crop.height)};function wi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _i=function(t){return t.preventDefault()},bi=B({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",_i,{passive:!1}),e.element.addEventListener("gesturestart",_i),e.ref.pointerPolyfill=function(t){var e={destroy:function(){}};if("onpointerdown"in window)return e;var n=0,r=[],i=function(t,e,n){var r=new UIEvent(e.type,{view:window,bubbles:!n});Object.keys(e).forEach(function(t){Object.defineProperty(r,t,{value:e[t],writable:!1})}),t.dispatchEvent(r)},o=function(t,e,o){return Array.from(e.changedTouches).map(function(a){var c=r[a.identifier],u={type:t,pageX:a.pageX,pageY:a.pageY,pointerId:a.identifier,isPrimary:c?c.isPrimary:0===n,preventDefault:function(){return e.preventDefault()}};return i(a.target,u,o),u})},a=function(t){o("pointerdown",t).forEach(function(t){r[t.pointerId]=t,n++})},c=function(t){o("pointermove",t)},u=function(t){o("pointerup",t).forEach(function(t){delete r[t.pointerId],n--})},l=function(t,e,n){var r={type:t,pageX:e.pageX,pageY:e.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return e.preventDefault()}};return i(e.target,r,n),r},s=function(t){l("pointerdown",t)},f=function(t){l("pointermove",t)},h=function(t){l("pointerup",t)};return"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchmove",c),t.addEventListener("touchend",u)):"onmousedown"in window&&(t.addEventListener("mousedown",s),t.addEventListener("mousemove",f),t.addEventListener("mouseup",h)),e.destroy=function(){r.length=0,t.removeEventListener("touchstart",a),t.removeEventListener("touchmove",c),t.removeEventListener("touchend",u),t.removeEventListener("mousedown",s),t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",h)},e}(e.element),e.appendChildView(e.createChildView(vi,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){wi(t,e,n[e])})}return t}({},n)))},destroy:function(t){var e=t.root;e.ref.pointerPolyfill.destroy(),e.element.removeEventListener("touchmove",_i,!0),e.element.removeEventListener("gesturestart",_i)}});function Oi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ti=function(){function t(){e.fire("touch-detected"),window.removeEventListener("touchstart",t,!1)}var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Oi(t,e,n[e])})}return t}({},ft(),{destroy:function(){window.removeEventListener("touchstart",t,!1)}});return window.addEventListener("touchstart",t,!1),e};function Ri(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var xi=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ri(t,e,n[e])})}return t}({},ft(),{destroy:function(){t.removeEventListener("dragover",n),t.removeEventListener("drop",r)}}),n=function(t){return t.preventDefault()},r=function(t){t.preventDefault();var n=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});e.fire("drop",n)};return t.addEventListener("dragover",n),t.addEventListener("drop",r),e},Ii=function(t){return t.ref.isFullscreen},Ai=function(t){return/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"))},Ci=function(t){return/fullscreen|preview/.test(t.query("GET_STYLE_LAYOUT_MODE"))},Mi=function(t){return t.query("GET_ALLOW_AUTO_CLOSE")},Si=Ci,Pi=Ci,Li=function(t){var e=t.ref,n=e.environment,r=e.isSingleUtil,i=e.canBeControlled;t.element.dataset.styleViewport=Ui(t.rect.element.width,t.rect.element.height)+" "+n.join(" ")+(r?" single-util":" multi-util")+(i?" flow-controls":" no-flow-controls")},Gi=function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,i=n.handleEscapeKey;e.setAttribute("tabindex",-1),r(),t.ref.focusTrap=function(t){var e=function(e){if(9===e.keyCode){var n=Array.from(t.querySelectorAll("button,input,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility&&-1!==t.tabIndex}),r=n[0],i=n[n.length-1];e.shiftKey?document.activeElement===r&&(i.focus(),e.preventDefault()):document.activeElement===i&&(r.focus(),e.preventDefault())}};return t.addEventListener("keydown",e),{destroy:function(){t.removeEventListener("keydown",e)}}}(e),e.addEventListener("keydown",i),window.addEventListener("resize",r),document.body.classList.add("doka--parent"),document.body.appendChild(e);var o=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent=o?o.getAttribute("content"):null,o||((o=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(o)),o.setAttribute("content","width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0"),t.opacity=1,t.element.contains(document.activeElement)||e.focus(),t.dispatch("INVALIDATE_VIEWPORT"),t.ref.isFullscreen=!0},Di=function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,i=n.focusTrap,o=n.handleEscapeKey;e.removeAttribute("tabindex"),i.destroy(),e.removeEventListener("keydown",o),window.removeEventListener("resize",r),document.body.classList.remove("doka--parent");var a=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent?(a.setAttribute("content",t.ref.defaultViewportContent),t.ref.defaultViewportContent=null):a.parentNode.removeChild(a),t.ref.isFullscreen=!1},Vi=B({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;e.element.id=e.query("GET_ID")||"doka-".concat(n.id),e.ref.environment=[],e.ref.shouldBeDestroyed=!1,e.ref.isClosing=!1,e.ref.isClosed=!1,e.ref.isFullscreen=!1,e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=xi(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=Ti(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.ref.editor=e.appendChildView(e.createChildView(bi,{id:n.id})),e.query("GET_STYLES").filter(function(t){return!q(t.value)}).map(function(t){var n=t.name,r=t.value;e.element.dataset[n]=r}),e.ref.updateViewport=function(){e.dispatch("INVALIDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),e.ref.isSingleUtil=1===e.query("GET_UTILS").length,e.ref.canBeControlled=e.query("GET_ALLOW_BUTTON_CONFIRM")||e.query("GET_ALLOW_BUTTON_CANCEL"),Li(e);var r=document.createElement("div");r.style.cssText="position:fixed;height:100vh;top:0;",e.ref.measure=r,document.body.appendChild(r),e.ref.handleEscapeKey=function(t){27===t.keyCode&&e.dispatch("EDIT_CANCEL")},e.ref.initialScreenMeasureHeight=null,e.ref.handleFullscreenUpdate=function(){e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight},e.ref.clientRect={left:0,top:0}},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null),e.ref.clientRect=e.element.getBoundingClientRect()},write:Y({ENTER_FULLSCREEN:function(t){var e=t.root;Gi(e)},EXIT_FULLSCREEN:function(t){var e=t.root;Di(e)},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.element.dataset.view=n.id},DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&e.dispatch("ENTER_FULLSCREEN")},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;if(0===e.opacity&&(e.opacity=1),e.ref.isClosing=!1,e.ref.isClosed=!1,!Ai(e)||Ii(e)){var n=e.query("GET_STYLE_LAYOUT_MODE");null!==n&&"modal"!==n||e.element.parentNode||e.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})}else e.dispatch("ENTER_FULLSCREEN")},DID_CANCEL:function(t){var e=t.root;Si(e)&&Mi(e)&&e.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(t){var e=t.root;Si(e)&&Mi(e)&&e.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(t){var e=t.root;Pi(e)&&(e.opacity=e.opacity||1,e.opacity=0,e.ref.isClosed=!1,e.ref.isClosing=!0,e.query("GET_ALLOW_AUTO_DESTROY")&&(e.ref.shouldBeDestroyed=!0),Ii(e)&&e.dispatch("EXIT_FULLSCREEN"))},DID_SET_UTILS:function(t){var e=t.root;e.ref.isSingleUtil=1===e.query("GET_UTILS").length}},function(t){var e=t.root;Li(e);var n=e.query("GET_ROOT"),r=e.rect.element;n.width===r.width&&n.height===r.height||e.dispatch("UPDATE_ROOT_RECT",{rect:{x:e.ref.clientRect.left,y:e.ref.clientRect.top,left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,width:e.rect.element.width,height:e.rect.element.height}})}),didWriteView:function(t){var e=t.root,n=e.ref,r=n.isClosed,i=n.isClosing,o=n.shouldBeDestroyed;!r&&i&&0===e.opacity&&(e.dispatch("DID_CLOSE"),e.ref.isClosed=!0,e.ref.isClosing=!1,Ai(e)&&e.element.parentNode&&document.body.removeChild(e.element),o&&e.dispatch("EDIT_DESTROY"))},destroy:function(t){var e=t.root;Ii(e)&&Di(e),Ai(e)&&e.element.parentNode&&document.body.removeChild(e.element),window.removeEventListener("resize",e.ref.updateViewport),e.ref.touchDetector.destroy(),e.ref.catcher&&e.ref.catcher.destroy()}}),Ui=function(t,e){var n="";return 0===t&&0===e?"detached":(n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim())};function Ni(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ki(t,e,n[e])})}return t}function ki(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ji=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=vt(),o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=c({},t),i=[],o=[],a=function(t,e,n){n?o.push({type:t,data:e}):(f[t]&&f[t](e),i.push({type:t,data:e}))},u=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return s[t]?(e=s)[t].apply(e,r):null},l={getState:function(){return c({},r)},processActionQueue:function(){var t=[].concat(i);return i.length=0,t},processDispatchQueue:function(){var t=[].concat(o);o.length=0,t.forEach(function(t){var e=t.type,n=t.data;a(e,n)})},dispatch:a,query:u},s={};e.forEach(function(t){s=c({},t(r),s)});var f={};return n.forEach(function(t){f=c({},t(a,u,r),f)}),l}((t={noImageTimeout:null,options:it(n)},ot(t),t),[se,lt(n)],[On,ut(n)]);o.dispatch("SET_OPTIONS",{options:e});var u=st(),f=null,h=Vi(o,{id:u}),d=!1,p={_read:function(){d||h._read()},_write:function(t){var e=o.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});d&&!e.length||(y(e),(d=h._write(t,e))&&o.processDispatchQueue(),e.find(function(t){return"EDIT_DESTROY"===t.type})&&v())}},m=function(t){return function(e){var n={type:t};return e?(e.hasOwnProperty("error")&&(n.error=a(e.error)?Ni({},e.error):e.error||null),e.hasOwnProperty("output")&&(n.output=e.output),e.hasOwnProperty("image")&&(n.image=e.image),e.hasOwnProperty("state")&&(n.state=e.state),n):n}},g={DID_CONFIRM:m("confirm"),DID_CANCEL:m("cancel"),DID_LOAD_IMAGE:m("load"),DID_LOAD_IMAGE_ERROR:m("loaderror"),DID_UPDATE:m("update"),DID_CLOSE:m("close"),DID_DESTROY:m("destroy"),DID_INIT:m("init")},y=function(t){t.length&&t.forEach(function(t){if(g[t.type]){var e=g[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=Ni({doka:E},t);delete e.type,h&&h.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var n=[];t.hasOwnProperty("error")&&n.push(t.error);var r=["type","error"];Object.keys(t).filter(function(t){return!r.includes(t)}).forEach(function(e){return n.push(t[e])}),E.fire.apply(E,[t.type].concat(n));var i=o.query("GET_ON".concat(t.type.toUpperCase()));i&&i.apply(void 0,n)}(e(t.data))},0)})}})},v=function(){E.fire("destroy",h.element),h._destroy(),o.dispatch("DID_DESTROY")},E=Ni({},ft(),p,function(t,e){var n={};return l(e,function(r){var i=H(e[r])?e[r]:r;n[r]={get:function(){return ct(r,i),t.getState().options[i]},set:function(e){ct(r,i),t.dispatch("SET_".concat(at(i,"_").toUpperCase()),{value:e})}}}),n}(o,n),{setOptions:function(t){return o.dispatch("SET_OPTIONS",{options:t})},setData:function(t){o.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,n){o.dispatch("GET_DATA",Ni({},t,{success:e,failure:n}))})},open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){t&&o.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:e,success:n,failure:r,resolveOnConfirm:!!e&&e.resolveOnConfirm})})},edit:function(t,e){return E.open(t,Ni({},e,{resolveOnConfirm:!0}))},save:function(t){return new Promise(function(e,n){o.dispatch("GET_DATA",Ni({},t,{success:e,failure:n}))})},clear:function(){return o.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return o.dispatch("EDIT_CLOSE")},destroy:v,insertBefore:function(t){r(h.element,t)},insertAfter:function(t){i(h.element,t)},appendTo:function(t){t.appendChild(h.element)},replaceElement:function(t){r(h.element,t),t.parentNode.removeChild(t),f=t},restoreElement:function(){f&&(i(f,h.element),h.element.parentNode.removeChild(h.element),f=null)},isAttachedTo:function(t){return!!h&&(h.element===t||f===t)},element:{get:function(){return h?h.element:null}}});return o.dispatch("DID_INIT"),s(E)};function zi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Bi=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=vt(),n={};return l(e,function(t,e){H(e)||(n[t]=e[0])}),l(t,function(t){H(e[t])&&ct(t,e[t])}),ji(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){zi(t,e,n[e])})}return t}({},n,t))},Yi=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})}(t.replace(/^data-/,""))},Fi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];l(t.attributes,function(e){return n.push(t.attributes[e])});var r=n.filter(function(t){return t.name}).reduce(function(e,n){var r=f(t,n.name);return e[Yi(n.name)]=r===n.name||r,e},{});return function t(e,n){l(n,function(n,r){l(e,function(t,i){var o=new RegExp(n);if(o.test(t)&&(delete e[t],!1!==r))if(H(r))e[r]=i;else{var c,u=r.group;a(r)&&!e[u]&&(e[u]={}),e[u][(c=t.replace(o,""),c.charAt(0).toLowerCase()+c.slice(1))]=i}}),r.mapping&&t(e[r.group],r.mapping)})}(r,e),r};function qi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Wi=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){qi(t,e,n[e])})}return t}({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=Fi(t,{"^class$":"className"});Object.keys(n).forEach(function(t){a(n[t])?(a(e[t])||(e[t]={}),Object.assign(e[t],n[t])):e[t]=n[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(e.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var r=Bi(e);return r.replaceElement(t),r};function Xi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Zi=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e[0]instanceof HTMLElement?Wi.apply(void 0,e):Bi.apply(void 0,Xi(e.filter(function(t){return t})))},Hi=["fire","_read","_write"],Ki=function(t){var e,n,r,i={};return e=t,n=i,r=Hi,Object.getOwnPropertyNames(e).filter(function(t){return!r.includes(t)}).forEach(function(t){return Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),i};n.d(e,"supported",function(){return Ji}),n.d(e,"OptionTypes",function(){return eo}),n.d(e,"create",function(){return no}),n.d(e,"destroy",function(){return ro}),n.d(e,"parse",function(){return io}),n.d(e,"find",function(){return oo}),n.d(e,"getOptions",function(){return ao}),n.d(e,"setOptions",function(){return co});var Qi,Ji=(Qi=pt()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window,function(){return Qi}),$i={apps:[]},to=function(){},eo={},no=to,ro=to,io=to,oo=to,ao=to,co=to;if(Ji()){!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(t),void window[r].writers.push(e);window[r]={readers:[t],writers:[e]};var i=window[r],o=1e3/n,a=null,c=null,u=null,l=null,s=function(){document.hidden?(u=function(){return window.setTimeout(function(){return f(performance.now())},o)},l=function(){return window.clearTimeout(c)}):(u=function(){return window.requestAnimationFrame(f)},l=function(){return window.cancelAnimationFrame(c)})};document.addEventListener("visibilitychange",function(){l&&l(),s(),f(performance.now())});var f=function t(e){c=u(t),a||(a=e);var n=e-a;n<=o||(a=e-n%o,i.readers.forEach(function(t){return t()}),i.writers.forEach(function(t){return t(e)}))};s(),f(performance.now())}(function(){$i.apps.forEach(function(t){return t._read()})},function(t){$i.apps.forEach(function(e){return e._write(t)})});var uo=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:Ji,create:no,destroy:ro,parse:io,find:oo,setOptions:co}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return uo()},0):document.addEventListener("DOMContentLoaded",uo);eo={},l(vt(),function(t,e){eo[t]=e[1]}),no=function(){var t=Zi.apply(void 0,arguments);return t.on("destroy",ro),$i.apps.push(t),Ki(t)},ro=function(t){var e=$i.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&($i.apps.splice(e,1)[0].restoreElement(),!0)},io=function(t){return Array.from(t.querySelectorAll(".".concat("doka"))).filter(function(t){return!$i.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return no(t)})},oo=function(t){var e=$i.apps.find(function(e){return e.isAttachedTo(t)});return e?Ki(e):null},ao=function(){var t={};return l(vt(),function(e,n){t[e]=n[0]}),t},co=function(t){return a(t)&&($i.apps.forEach(function(e){e.setOptions(t)}),function(t){l(t,function(t,e){wt[t]&&Et(t,e)})}(t)),ao()}}}])});